<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7-Day RESTful API Design Learning Module</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f7fa;
            --bg-tertiary: #e8ecf1;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --accent: #003366;
            --accent-hover: #004488;
            --accent-light: #e6f0ff;
            --success: #27ae60;
            --success-light: #d5f4e3;
            --warning: #FFB81C;
            --warning-light: #fff8e6;
            --error: #e74c3c;
            --code-bg: #1e2a3a;
            --code-text: #ecf0f1;
            --border: #e1e8ed;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        body.dark-mode {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #eee;
            --text-secondary: #bdc3c7;
            --accent: #5dade2;
            --accent-hover: #7ec8e8;
            --accent-light: #1a3a5c;
            --success: #2ecc71;
            --warning: #FFB81C;
            --code-bg: #0a1628;
            --code-text: #ecf0f1;
            --border: #34495e;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .container { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--bg-secondary);
            padding: 25px 20px;
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--accent);
        }
        
        .sidebar-header h2 { font-size: 18px; color: var(--accent); margin-bottom: 5px; }
        .sidebar-header p { font-size: 12px; color: var(--text-secondary); }
        
        .nav-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            margin-bottom: 8px;
            background-color: var(--bg-primary);
            border-radius: 10px;
            text-decoration: none;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.25s ease;
            border-left: 4px solid transparent;
            font-weight: 500;
        }
        
        .nav-item:hover { 
            background-color: var(--accent-light); 
            border-left-color: var(--accent);
            transform: translateX(3px);
        }
        
        .nav-item.active { 
            background-color: var(--accent); 
            color: white; 
            border-left-color: var(--warning);
            box-shadow: var(--shadow);
        }
        
        .nav-item.completed::after { content: " ‚úì"; color: var(--success); font-weight: bold; margin-left: 8px; }
        .nav-item.active.completed::after { color: var(--warning); }
        
        /* Main Content */
        .main { 
            margin-left: 280px; 
            flex: 1; 
            padding: 40px 50px; 
            max-width: 1000px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--accent);
        }
        
        .header h1 { font-size: 26px; color: var(--accent); }
        
        .header-controls { display: flex; gap: 10px; }
        
        .theme-toggle, .reset-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .theme-toggle:hover, .reset-btn:hover { 
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }
        
        .reset-btn { background-color: var(--error); }
        .reset-btn:hover { background-color: #c0392b; }

        /* Progress Container */
        .progress-container {
            margin-bottom: 35px;
            background-color: var(--bg-secondary);
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        #progress-text { color: var(--accent); }
        #days-completed { color: var(--text-secondary); }
        
        .progress-bar {
            width: 100%;
            height: 28px;
            background-color: var(--bg-tertiary);
            border-radius: 14px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            transition: width 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 13px;
            min-width: 0;
            border-radius: 14px;
        }
        
        /* Day Content */
        .day-content { display: none; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .day-content.active { display: block; }
        
        .day-content h2 { 
            font-size: 26px; 
            margin-bottom: 25px; 
            color: var(--accent);
        }
        
        .day-content h3 { 
            font-size: 20px; 
            margin-top: 35px; 
            margin-bottom: 18px;
            color: var(--text-primary);
            border-left: 4px solid var(--accent);
            padding-left: 15px;
        }
        
        .day-content h4 { font-size: 17px; margin-top: 25px; margin-bottom: 12px; color: var(--text-secondary); }
        .day-content p { margin-bottom: 16px; }
        .day-content ul, .day-content ol { margin-bottom: 18px; padding-left: 28px; }
        .day-content li { margin-bottom: 10px; }
        
        /* Objectives Box */
        .objectives {
            background: linear-gradient(135deg, var(--accent-light), var(--bg-secondary));
            padding: 25px;
            border-left: 5px solid var(--accent);
            margin-bottom: 30px;
            border-radius: 0 12px 12px 0;
        }
        
        .objectives h3 { margin-top: 0; margin-bottom: 18px; border-left: none; padding-left: 0; color: var(--accent); }
        .objectives ul { list-style: none; padding-left: 0; margin-bottom: 0; }
        .objectives li { padding: 8px 0; padding-left: 28px; position: relative; }
        .objectives li::before { content: "‚úì"; color: var(--success); font-weight: bold; position: absolute; left: 0; }

        /* Concept Cards */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .concept-card {
            background-color: var(--bg-secondary);
            padding: 22px;
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.25s;
        }
        
        .concept-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            border-color: var(--accent);
        }
        
        .concept-card h4 { color: var(--accent); margin-top: 0; margin-bottom: 12px; font-size: 16px; }
        .concept-card p { margin-bottom: 0; font-size: 14px; color: var(--text-secondary); }
        
        /* Code Blocks */
        .code-block { position: relative; margin: 20px 0; border-radius: 10px; overflow: hidden; }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #1a252f;
            padding: 12px 18px;
        }
        
        .code-header span { color: #8b9fad; font-size: 13px; font-weight: 600; }
        
        .copy-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .copy-btn:hover { background-color: var(--accent-hover); }
        .copy-btn.copied { background-color: var(--success); }
        
        pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 20px;
            overflow-x: auto;
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        code { font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace; }
        
        /* Inline code */
        p code, li code {
            background-color: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--accent);
        }

        /* Exercise Box */
        .exercise {
            background-color: var(--warning-light);
            border: 2px solid var(--warning);
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
        }
        
        .exercise h4 { color: #b8860b; margin-top: 0; margin-bottom: 15px; font-size: 18px; }
        
        details {
            margin-top: 15px;
            background-color: var(--bg-primary);
            border-radius: 8px;
            padding: 15px;
        }
        
        details summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--accent);
            padding: 5px 0;
        }
        
        details summary:hover { color: var(--accent-hover); }
        details[open] summary { margin-bottom: 15px; }
        
        /* Quiz Section */
        .quiz {
            background-color: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            border: 1px solid var(--border);
        }
        
        .quiz h3 { margin-top: 0; margin-bottom: 25px; border-left: none; padding-left: 0; }
        
        .quiz-question {
            background-color: var(--bg-primary);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .quiz-question p { margin-bottom: 15px; font-weight: 600; }
        
        .quiz-options { margin-bottom: 15px; }
        .quiz-options label {
            display: block;
            padding: 12px 15px;
            margin-bottom: 8px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .quiz-options label:hover { background-color: var(--accent-light); border-color: var(--accent); }
        .quiz-options input[type="radio"] { margin-right: 12px; }
        
        .check-answer {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .check-answer:hover { background-color: var(--accent-hover); transform: translateY(-2px); }
        
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }
        
        .feedback.correct { display: block; background-color: var(--success-light); color: var(--success); }
        .feedback.incorrect { display: block; background-color: #fde8e6; color: var(--error); }

        /* Takeaways Box */
        .takeaways {
            background: linear-gradient(135deg, var(--success-light), var(--bg-secondary));
            padding: 25px;
            border-left: 5px solid var(--success);
            margin: 30px 0;
            border-radius: 0 12px 12px 0;
        }
        
        .takeaways h3 { margin-top: 0; border-left: none; padding-left: 0; color: var(--success); }
        
        /* Complete Day Button */
        .complete-day {
            display: block;
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--success), #219653);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 40px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        .complete-day:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .complete-day:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Storage Demo */
        .storage-demo {
            background-color: var(--accent-light);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border: 2px dashed var(--accent);
        }
        
        .storage-demo h4 { color: var(--accent); margin-top: 0; }
        
        /* Info Box */
        .info-box {
            background-color: var(--accent-light);
            border-left: 4px solid var(--accent);
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .info-box.warning {
            background-color: var(--warning-light);
            border-left-color: var(--warning);
        }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: var(--bg-primary);
            border-radius: 10px;
            overflow: hidden;
        }
        
        th, td {
            padding: 14px 18px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background-color: var(--accent);
            color: white;
            font-weight: 600;
        }
        
        tr:hover { background-color: var(--bg-secondary); }
        
        /* Responsive */
        @media (max-width: 900px) {
            .sidebar { width: 220px; padding: 15px; }
            .main { margin-left: 220px; padding: 25px; }
        }
        
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; position: relative; }
            .main { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>üöÄ RESTful API Design</h2>
                <p>7-Day Learning Module</p>
            </div>
            <div id="nav-container"></div>
        </nav>
        
        <main class="main">
            <header class="header">
                <h1>üì° RESTful API Design with Node.js</h1>
                <div class="header-controls">
                    <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
                    <button class="reset-btn" onclick="resetProgress()">‚Ü∫ Reset</button>
                </div>
            </header>
            
            <div class="progress-container">
                <div class="progress-header">
                    <span id="progress-text">0% Complete</span>
                    <span id="days-completed">0/7 Days</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <!-- DAY 1 CONTENT -->
            <div id="day1" class="day-content active">
                <h2>üìò Day 1: REST Fundamentals & HTTP Methods</h2>
                
                <div class="objectives">
                    <h3>üéØ Learning Objectives</h3>
                    <ul>
                        <li>Understand what REST architecture is and its core principles</li>
                        <li>Master HTTP methods (GET, POST, PUT, PATCH, DELETE)</li>
                        <li>Learn proper URL/resource naming conventions</li>
                        <li>Set up your first Express.js server</li>
                        <li>Create your first RESTful endpoint</li>
                    </ul>
                </div>
                
                <h3>üìö Core Concepts</h3>
                
                <div class="concept-grid">
                    <div class="concept-card">
                        <h4>üîÑ What is REST?</h4>
                        <p>REST (Representational State Transfer) is an architectural style for designing networked applications. It uses HTTP requests to perform CRUD operations on resources.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üì¶ Resources</h4>
                        <p>Everything in REST is a resource (users, products, orders). Resources are identified by URLs and manipulated using HTTP methods.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üîÄ Stateless</h4>
                        <p>Each request contains all information needed to process it. The server doesn't store client state between requests.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üìã Uniform Interface</h4>
                        <p>REST uses standard HTTP methods consistently: GET (read), POST (create), PUT (replace), PATCH (update), DELETE (remove).</p>
                    </div>
                </div>
                
                <h3>üîß HTTP Methods Deep Dive</h3>
                
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Purpose</th>
                            <th>Idempotent</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>GET</code></td>
                            <td>Retrieve resource(s)</td>
                            <td>Yes</td>
                            <td>GET /api/users</td>
                        </tr>
                        <tr>
                            <td><code>POST</code></td>
                            <td>Create new resource</td>
                            <td>No</td>
                            <td>POST /api/users</td>
                        </tr>
                        <tr>
                            <td><code>PUT</code></td>
                            <td>Replace entire resource</td>
                            <td>Yes</td>
                            <td>PUT /api/users/123</td>
                        </tr>
                        <tr>
                            <td><code>PATCH</code></td>
                            <td>Partial update</td>
                            <td>Yes</td>
                            <td>PATCH /api/users/123</td>
                        </tr>
                        <tr>
                            <td><code>DELETE</code></td>
                            <td>Remove resource</td>
                            <td>Yes</td>
                            <td>DELETE /api/users/123</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="info-box">
                    <strong>üí° Idempotent</strong> means that making the same request multiple times produces the same result. GET, PUT, PATCH, and DELETE are idempotent. POST is not‚Äîcalling it twice creates two resources.
                </div>
                
                <h3>üíª Code Examples</h3>
                
                <h4>1. Setting Up Express.js</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Initial Express Setup</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d1-1')">Copy</button>
                    </div>
                    <pre><code id="code-d1-1">// First, initialize your project and install Express
// Run in terminal: npm init -y && npm install express

const express = require('express');
const app = express();
const PORT = 3000;

// Middleware to parse JSON request bodies
app.use(express.json());

// Simple health check endpoint
app.get('/api/health', (req, res) => {
    res.json({ 
        status: 'ok', 
        timestamp: new Date().toISOString() 
    });
});

// Start the server
app.listen(PORT, () => {
    console.log(`üöÄ Server running at http://localhost:${PORT}`);
});
</code></pre>
                </div>

                <h4>2. Complete CRUD Endpoints</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Full CRUD Example</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d1-2')">Copy</button>
                    </div>
                    <pre><code id="code-d1-2">const express = require('express');
const app = express();
app.use(express.json());

// In-memory data store (replace with database in production)
let users = [
    { id: 1, name: 'Alice Johnson', email: 'alice@example.com' },
    { id: 2, name: 'Bob Smith', email: 'bob@example.com' }
];
let nextId = 3;

// GET all users
app.get('/api/users', (req, res) => {
    res.json(users);
});

// GET single user by ID
app.get('/api/users/:id', (req, res) => {
    const user = users.find(u => u.id === parseInt(req.params.id));
    if (!user) {
        return res.status(404).json({ error: 'User not found' });
    }
    res.json(user);
});

// POST create new user
app.post('/api/users', (req, res) => {
    const { name, email } = req.body;
    if (!name || !email) {
        return res.status(400).json({ error: 'Name and email are required' });
    }
    const newUser = { id: nextId++, name, email };
    users.push(newUser);
    res.status(201).json(newUser);
});

// PUT replace user entirely
app.put('/api/users/:id', (req, res) => {
    const index = users.findIndex(u => u.id === parseInt(req.params.id));
    if (index === -1) {
        return res.status(404).json({ error: 'User not found' });
    }
    const { name, email } = req.body;
    users[index] = { id: parseInt(req.params.id), name, email };
    res.json(users[index]);
});

// PATCH partial update
app.patch('/api/users/:id', (req, res) => {
    const user = users.find(u => u.id === parseInt(req.params.id));
    if (!user) {
        return res.status(404).json({ error: 'User not found' });
    }
    Object.assign(user, req.body);
    res.json(user);
});

// DELETE user
app.delete('/api/users/:id', (req, res) => {
    const index = users.findIndex(u => u.id === parseInt(req.params.id));
    if (index === -1) {
        return res.status(404).json({ error: 'User not found' });
    }
    users.splice(index, 1);
    res.status(204).send();
});

app.listen(3000, () => console.log('Server running on port 3000'));
</code></pre>
                </div>

                <h4>3. Building an Actual API with Node.js HTTP Module</h4>
                <p>Before using frameworks like Express, it's valuable to understand how Node.js creates HTTP servers using the core <code>http</code> module. This example demonstrates building a complete API from scratch with template rendering and routing.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Complete Node.js HTTP Server</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d1-3')">Copy</button>
                    </div>
                    <pre><code id="code-d1-3">const fs = require('fs');
const http = require('http');
const url = require('url');
const slugify = require('slugify');

// ============================================
// 1. FILE READING (Synchronous - runs once at startup)
// ============================================
// Read HTML templates - these are placeholders that will be filled with data
const tempOverview = fs.readFileSync(`${__dirname}/templates/template-overview.html`, 'utf-8');
const tempCard = fs.readFileSync(`${__dirname}/templates/template-card.html`, 'utf-8');
const tempProduct = fs.readFileSync(`${__dirname}/templates/template-product.html`, 'utf-8');

// Read JSON data file - contains product information
const data = fs.readFileSync(`${__dirname}/dev-data/data.json`, 'utf-8');
const dataObj = JSON.parse(data);  // Parse JSON string into JavaScript object

// Create URL slugs for SEO-friendly URLs (e.g., "Fresh Avocados" ‚Üí "fresh-avocados")
const slugs = dataObj.map(el => slugify(el.productName, { lower: true }));
console.log(slugs);

// ============================================
// 2. TEMPLATE REPLACEMENT HELPER FUNCTION
// ============================================
const replaceTemplate = (temp, product) => {
    // Use regex with /g flag to replace ALL occurrences, not just the first
    let output = temp.replace(/{%PRODUCTNAME%}/g, product.productName);
    output = output.replace(/{%IMAGE%}/g, product.image);
    output = output.replace(/{%PRICE%}/g, product.price);
    output = output.replace(/{%FROM%}/g, product.from);
    output = output.replace(/{%NUTRIENTS%}/g, product.nutrients);
    output = output.replace(/{%QUANTITY%}/g, product.quantity);
    output = output.replace(/{%DESCRIPTION%}/g, product.description);
    output = output.replace(/{%ID%}/g, product.id);

    // Conditional rendering: add 'not-organic' class if product is not organic
    if (!product.organic) output = output.replace(/{%NOT_ORGANIC%}/g, 'not-organic');
    return output;
};

// ============================================
// 3. HTTP SERVER CREATION
// ============================================
const server = http.createServer((req, res) => {
    // Parse the request URL to extract pathname and query parameters
    const { query, pathname } = url.parse(req.url, true);  // true = parse query string

    // ============================================
    // 4. ROUTING LOGIC
    // ============================================

    // Route: Overview/Home Page
    if (pathname === '/' || pathname === '/overview') {
        res.writeHead(200, { 'Content-type': 'text/html' });

        // Generate HTML cards for each product using map
        const cardsHtml = dataObj.map(el => replaceTemplate(tempCard, el)).join('');
        // Insert all cards into the overview template
        const output = tempOverview.replace('{%PRODUCT_CARDS%}', cardsHtml);

        res.end(output);
    }

    // Route: Individual Product Page (with dynamic ID from query string)
    else if (pathname === '/product') {
        res.writeHead(200, { 'Content-type': 'text/html' });

        // Get the product by ID from query parameter (?id=0)
        const product = dataObj[query.id];
        const output = replaceTemplate(tempProduct, product);

        res.end(output);
    }

    // Route: API Endpoint (returns raw JSON data)
    else if (pathname === '/api') {
        res.writeHead(200, { 'Content-type': 'application/json' });
        res.end(data);  // Send the raw JSON string
    }

    // Route: 404 Not Found
    else {
        res.writeHead(404, {
            'Content-type': 'text/html',
            'my-own-header': 'hello-world'  // Custom headers can be added
        });
        res.end('&lt;h1&gt;Page not found!&lt;/h1&gt;');
    }
});

// Start server on port 8000
server.listen(8000, '127.0.0.1', () => {
    console.log('Listening to requests on port 8000');
});
</code></pre>
                </div>

                <div class="info-box">
                    <h4>üìñ Code Explanation: Grammar & Syntax Breakdown</h4>

                    <p><strong>1. Template Literals with <code>${}</code>:</strong></p>
                    <ul>
                        <li><code>`${__dirname}/templates/file.html`</code> - Backticks allow embedded expressions</li>
                        <li><code>__dirname</code> - Node.js global variable for current directory path</li>
                        <li>More readable than string concatenation: <code>__dirname + '/templates/file.html'</code></li>
                    </ul>

                    <p><strong>2. Destructuring Assignment:</strong></p>
                    <ul>
                        <li><code>const { query, pathname } = url.parse(req.url, true)</code></li>
                        <li>Extracts specific properties from an object into variables</li>
                        <li>Equivalent to: <code>const query = parsed.query; const pathname = parsed.pathname;</code></li>
                    </ul>

                    <p><strong>3. Arrow Functions:</strong></p>
                    <ul>
                        <li><code>(req, res) => { ... }</code> - Concise function syntax</li>
                        <li>Shorter than: <code>function(req, res) { ... }</code></li>
                        <li>Automatically binds <code>this</code> context (not relevant here, but important in other cases)</li>
                    </ul>

                    <p><strong>4. Regex Global Flag <code>/g</code>:</strong></p>
                    <ul>
                        <li><code>/{%PRODUCTNAME%}/g</code> - The <code>g</code> flag replaces ALL matches</li>
                        <li>Without <code>g</code>, only the first occurrence is replaced</li>
                        <li>Essential when a placeholder appears multiple times in a template</li>
                    </ul>

                    <p><strong>5. Ternary Operator (implied):</strong></p>
                    <ul>
                        <li><code>if (!product.organic)</code> - Checks if organic property is false</li>
                        <li>Could be written as ternary: <code>product.organic ? '' : 'not-organic'</code></li>
                    </ul>
                </div>

                <div class="info-box warning">
                    <h4>‚úÖ Dos and ‚ùå Don'ts</h4>

                    <p><strong>‚úÖ DO:</strong></p>
                    <ul>
                        <li><strong>Read files synchronously at startup:</strong> <code>fs.readFileSync()</code> is acceptable for loading templates/config during initialization before the server starts handling requests</li>
                        <li><strong>Set proper Content-Type headers:</strong> <code>'text/html'</code> for HTML, <code>'application/json'</code> for JSON</li>
                        <li><strong>Use HTTP status codes correctly:</strong> 200 for success, 404 for not found</li>
                        <li><strong>Parse URLs properly:</strong> Use <code>url.parse()</code> to extract pathname and query parameters</li>
                        <li><strong>Create slugs for SEO:</strong> Convert "Fresh Avocados" to "fresh-avocados" for clean URLs</li>
                        <li><strong>Validate user input:</strong> Check if <code>query.id</code> exists and is valid before using it</li>
                    </ul>

                    <p><strong>‚ùå DON'T:</strong></p>
                    <ul>
                        <li><strong>Use synchronous file operations inside request handlers:</strong> <code>fs.readFileSync()</code> blocks the entire server - use <code>fs.readFile()</code> (async) or read once at startup</li>
                        <li><strong>Forget error handling:</strong> This example doesn't handle missing files or invalid product IDs (production code needs try-catch blocks)</li>
                        <li><strong>Skip input validation:</strong> Always validate <code>query.id</code> to prevent accessing <code>dataObj[undefined]</code></li>
                        <li><strong>Hardcode file paths:</strong> Use <code>__dirname</code> to make paths relative to the script location</li>
                        <li><strong>Forget to set Content-Type:</strong> Browsers need this header to render content correctly</li>
                        <li><strong>Use GET for state-changing operations:</strong> GET should only retrieve data, not modify it</li>
                    </ul>
                </div>

                <div class="info-box">
                    <h4>üîç Key Learning Points</h4>
                    <ul>
                        <li><strong>File I/O Timing:</strong> Read templates once at startup (synchronous is OK), not on every request</li>
                        <li><strong>Routing Pattern:</strong> Use if-else blocks to check pathname and route to appropriate handler</li>
                        <li><strong>Template System:</strong> Simple string replacement works for basic needs; frameworks provide more power</li>
                        <li><strong>Separation of Concerns:</strong> Helper functions (<code>replaceTemplate</code>) keep code organized</li>
                        <li><strong>HTTP Fundamentals:</strong> Understanding <code>http.createServer()</code> helps appreciate what Express.js abstracts</li>
                    </ul>
                </div>

                <div class="storage-demo">
                    <h4>üíæ localStorage Practical: API Request Logger</h4>
                    <p>Track your API learning progress by logging requests you've tested:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JavaScript - localStorage API Logger</span>
                            <button class="copy-btn" onclick="copyCode(this, 'storage-d1')">Copy</button>
                        </div>
                        <pre><code id="storage-d1">// API Request Logger - Save your practice session
const API_LOG_KEY = 'day1_api_requests_log';

// Log a new API request you've tested
function logRequest(method, endpoint, statusCode) {
    const logs = JSON.parse(localStorage.getItem(API_LOG_KEY)) || [];
    logs.push({
        method,
        endpoint,
        statusCode,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem(API_LOG_KEY, JSON.stringify(logs));
    console.log(`‚úÖ Logged: ${method} ${endpoint} ‚Üí ${statusCode}`);
}

// View all logged requests
function viewLogs() {
    const logs = JSON.parse(localStorage.getItem(API_LOG_KEY)) || [];
    console.table(logs);
    return logs;
}

// Get summary stats
function getStats() {
    const logs = JSON.parse(localStorage.getItem(API_LOG_KEY)) || [];
    const stats = {
        total: logs.length,
        byMethod: {}
    };
    logs.forEach(log => {
        stats.byMethod[log.method] = (stats.byMethod[log.method] || 0) + 1;
    });
    return stats;
}

// Clear all logs
function clearLogs() {
    localStorage.removeItem(API_LOG_KEY);
    console.log('üóëÔ∏è Logs cleared');
}

// Usage examples:
logRequest('GET', '/api/users', 200);
logRequest('POST', '/api/users', 201);
logRequest('DELETE', '/api/users/1', 204);
console.log('Stats:', getStats());
</code></pre>
                    </div>
                </div>

                <div class="exercise">
                    <h4>üèãÔ∏è Exercise: Build a Products API</h4>
                    <p><strong>Scenario:</strong> You're building an e-commerce backend and need a Products API.</p>
                    <p><strong>Task:</strong> Create CRUD endpoints for managing products.</p>
                    <p><strong>Requirements:</strong></p>
                    <ul>
                        <li>Each product has: id, name, price, category</li>
                        <li>GET /api/products - List all products</li>
                        <li>POST /api/products - Create a new product</li>
                        <li>GET /api/products/:id - Get single product</li>
                    </ul>
                    
                    <details>
                        <summary>üí° Hint</summary>
                        <p>Start with an array of sample products. Use <code>req.params.id</code> to access URL parameters and <code>req.body</code> to access POST data.</p>
                    </details>
                    
                    <details>
                        <summary>‚úÖ Solution</summary>
                        <div class="code-block">
                            <div class="code-header">
                                <span>JavaScript - Products API Solution</span>
                                <button class="copy-btn" onclick="copyCode(this, 'solution-d1')">Copy</button>
                            </div>
                            <pre><code id="solution-d1">const express = require('express');
const app = express();
app.use(express.json());

let products = [
    { id: 1, name: 'Laptop', price: 999.99, category: 'Electronics' },
    { id: 2, name: 'Coffee Mug', price: 12.99, category: 'Kitchen' }
];
let nextId = 3;

// GET all products
app.get('/api/products', (req, res) => {
    res.json(products);
});

// GET single product
app.get('/api/products/:id', (req, res) => {
    const product = products.find(p => p.id === parseInt(req.params.id));
    if (!product) {
        return res.status(404).json({ error: 'Product not found' });
    }
    res.json(product);
});

// POST create product
app.post('/api/products', (req, res) => {
    const { name, price, category } = req.body;
    if (!name || !price) {
        return res.status(400).json({ error: 'Name and price required' });
    }
    const newProduct = { 
        id: nextId++, 
        name, 
        price: parseFloat(price), 
        category: category || 'Uncategorized' 
    };
    products.push(newProduct);
    res.status(201).json(newProduct);
});

app.listen(3000, () => console.log('Products API running'));
</code></pre>
                        </div>
                        <p><strong>Explanation:</strong> We use an in-memory array to store products. The <code>parseInt()</code> converts the URL parameter string to a number for comparison. Status 201 indicates successful resource creation.</p>
                    </details>
                </div>
                
                <div class="quiz">
                    <h3>‚úÖ Check Your Knowledge</h3>
                    
                    <div class="quiz-question">
                        <p><strong>Q1:</strong> Which HTTP method should you use to update only the email field of a user?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d1q1" value="a"> A) PUT</label>
                            <label><input type="radio" name="d1q1" value="b"> B) PATCH</label>
                            <label><input type="radio" name="d1q1" value="c"> C) POST</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d1q1', 'b', 'd1q1-fb')">Check Answer</button>
                        <div class="feedback" id="d1q1-fb"></div>
                    </div>
                    
                    <div class="quiz-question">
                        <p><strong>Q2:</strong> What status code should a successful DELETE request return?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d1q2" value="a"> A) 200 OK</label>
                            <label><input type="radio" name="d1q2" value="b"> B) 201 Created</label>
                            <label><input type="radio" name="d1q2" value="c"> C) 204 No Content</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d1q2', 'c', 'd1q2-fb')">Check Answer</button>
                        <div class="feedback" id="d1q2-fb"></div>
                    </div>
                    
                    <div class="quiz-question">
                        <p><strong>Q3:</strong> Which HTTP method is NOT idempotent?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d1q3" value="a"> A) GET</label>
                            <label><input type="radio" name="d1q3" value="b"> B) POST</label>
                            <label><input type="radio" name="d1q3" value="c"> C) PUT</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d1q3', 'b', 'd1q3-fb')">Check Answer</button>
                        <div class="feedback" id="d1q3-fb"></div>
                    </div>
                </div>
                
                <div class="takeaways">
                    <h3>üéØ Key Takeaways</h3>
                    <ul>
                        <li>REST uses HTTP methods to perform CRUD operations on resources</li>
                        <li>Resources are identified by URLs (e.g., /api/users/123)</li>
                        <li>Use proper HTTP methods: GET (read), POST (create), PUT/PATCH (update), DELETE (remove)</li>
                        <li>Status codes communicate the result: 200 (OK), 201 (Created), 204 (No Content), 404 (Not Found)</li>
                    </ul>
                    <p><strong>Tomorrow:</strong> We'll dive into proper resource design and URL patterns for complex APIs.</p>
                </div>
                
                <button class="complete-day" onclick="completeDay(1)">‚úì Mark Day 1 Complete</button>
            </div>

            <!-- DAY 2 CONTENT -->
            <div id="day2" class="day-content">
                <h2>üìò Day 2: Resource Design & URL Patterns</h2>
                
                <div class="objectives">
                    <h3>üéØ Learning Objectives</h3>
                    <ul>
                        <li>Design intuitive and consistent URL structures</li>
                        <li>Implement nested resources and relationships</li>
                        <li>Use query parameters for filtering, sorting, and pagination</li>
                        <li>Apply REST naming conventions and best practices</li>
                        <li>Handle collection vs. singleton resources</li>
                    </ul>
                </div>
                
                <h3>üìö Core Concepts</h3>
                
                <div class="concept-grid">
                    <div class="concept-card">
                        <h4>üìÅ Resource Naming</h4>
                        <p>Use plural nouns for collections (/users, /products). Keep URLs lowercase with hyphens for multi-word resources (/order-items).</p>
                    </div>
                    <div class="concept-card">
                        <h4>üîó Nested Resources</h4>
                        <p>Express relationships through URL hierarchy: /users/123/orders shows orders belonging to user 123.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üîç Query Parameters</h4>
                        <p>Use for filtering (?status=active), sorting (?sort=name), and pagination (?page=2&limit=10).</p>
                    </div>
                    <div class="concept-card">
                        <h4>üìä HATEOAS</h4>
                        <p>Include links in responses to guide clients to related resources and available actions.</p>
                    </div>
                </div>
                
                <h3>üîß URL Pattern Best Practices</h3>
                
                <table>
                    <thead>
                        <tr>
                            <th>‚ùå Bad</th>
                            <th>‚úÖ Good</th>
                            <th>Why</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/getUsers</code></td>
                            <td><code>/users</code></td>
                            <td>HTTP method indicates action</td>
                        </tr>
                        <tr>
                            <td><code>/user/123</code></td>
                            <td><code>/users/123</code></td>
                            <td>Use plural consistently</td>
                        </tr>
                        <tr>
                            <td><code>/users/123/getOrders</code></td>
                            <td><code>/users/123/orders</code></td>
                            <td>No verbs in URLs</td>
                        </tr>
                        <tr>
                            <td><code>/Users_List</code></td>
                            <td><code>/users</code></td>
                            <td>Lowercase, no underscores</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>üíª Code Examples</h3>
                
                <h4>1. Nested Resources</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Nested Routes</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d2-1')">Copy</button>
                    </div>
                    <pre><code id="code-d2-1">const express = require('express');
const app = express();
app.use(express.json());

// Sample data with relationships
let users = [
    { id: 1, name: 'Alice', email: 'alice@example.com' },
    { id: 2, name: 'Bob', email: 'bob@example.com' }
];

let orders = [
    { id: 1, userId: 1, product: 'Laptop', total: 999.99, status: 'shipped' },
    { id: 2, userId: 1, product: 'Mouse', total: 29.99, status: 'delivered' },
    { id: 3, userId: 2, product: 'Keyboard', total: 79.99, status: 'pending' }
];

// GET all users
app.get('/api/users', (req, res) => {
    res.json(users);
});

// GET single user
app.get('/api/users/:userId', (req, res) => {
    const user = users.find(u => u.id === parseInt(req.params.userId));
    if (!user) return res.status(404).json({ error: 'User not found' });
    res.json(user);
});

// GET all orders for a specific user (nested resource)
app.get('/api/users/:userId/orders', (req, res) => {
    const userId = parseInt(req.params.userId);
    const user = users.find(u => u.id === userId);
    if (!user) return res.status(404).json({ error: 'User not found' });
    
    const userOrders = orders.filter(o => o.userId === userId);
    res.json(userOrders);
});

// GET specific order for a user
app.get('/api/users/:userId/orders/:orderId', (req, res) => {
    const userId = parseInt(req.params.userId);
    const orderId = parseInt(req.params.orderId);
    
    const order = orders.find(o => o.id === orderId && o.userId === userId);
    if (!order) return res.status(404).json({ error: 'Order not found' });
    
    res.json(order);
});

// POST create new order for user
app.post('/api/users/:userId/orders', (req, res) => {
    const userId = parseInt(req.params.userId);
    const user = users.find(u => u.id === userId);
    if (!user) return res.status(404).json({ error: 'User not found' });
    
    const newOrder = {
        id: orders.length + 1,
        userId: userId,
        product: req.body.product,
        total: req.body.total,
        status: 'pending'
    };
    orders.push(newOrder);
    res.status(201).json(newOrder);
});

app.listen(3000, () => console.log('Server running on port 3000'));
</code></pre>
                </div>

                <h4>2. Query Parameters: Filtering, Sorting, Pagination</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Query Parameters</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d2-2')">Copy</button>
                    </div>
                    <pre><code id="code-d2-2">const express = require('express');
const app = express();

// Sample products data
let products = [
    { id: 1, name: 'Laptop', price: 999, category: 'electronics', inStock: true },
    { id: 2, name: 'Coffee Mug', price: 15, category: 'kitchen', inStock: true },
    { id: 3, name: 'Headphones', price: 199, category: 'electronics', inStock: false },
    { id: 4, name: 'Desk Lamp', price: 45, category: 'office', inStock: true },
    { id: 5, name: 'Notebook', price: 8, category: 'office', inStock: true }
];

// GET /api/products with filtering, sorting, and pagination
app.get('/api/products', (req, res) => {
    let result = [...products];
    
    // FILTERING: ?category=electronics&inStock=true
    if (req.query.category) {
        result = result.filter(p => p.category === req.query.category);
    }
    if (req.query.inStock !== undefined) {
        const inStock = req.query.inStock === 'true';
        result = result.filter(p => p.inStock === inStock);
    }
    if (req.query.minPrice) {
        result = result.filter(p => p.price >= parseFloat(req.query.minPrice));
    }
    if (req.query.maxPrice) {
        result = result.filter(p => p.price <= parseFloat(req.query.maxPrice));
    }
    
    // SORTING: ?sort=price&order=desc
    if (req.query.sort) {
        const sortField = req.query.sort;
        const sortOrder = req.query.order === 'desc' ? -1 : 1;
        result.sort((a, b) => {
            if (a[sortField] < b[sortField]) return -1 * sortOrder;
            if (a[sortField] > b[sortField]) return 1 * sortOrder;
            return 0;
        });
    }
    
    // PAGINATION: ?page=1&limit=10
    const page = parseInt(req.query.page) || 1;
    const limit = parseInt(req.query.limit) || 10;
    const startIndex = (page - 1) * limit;
    const endIndex = startIndex + limit;
    
    const paginatedResult = result.slice(startIndex, endIndex);
    
    // Response with metadata
    res.json({
        data: paginatedResult,
        pagination: {
            currentPage: page,
            itemsPerPage: limit,
            totalItems: result.length,
            totalPages: Math.ceil(result.length / limit),
            hasNextPage: endIndex < result.length,
            hasPrevPage: page > 1
        }
    });
});

app.listen(3000, () => console.log('Server running'));

// Example queries:
// GET /api/products?category=electronics
// GET /api/products?minPrice=50&maxPrice=500
// GET /api/products?sort=price&order=desc
// GET /api/products?page=1&limit=2
</code></pre>
                </div>
                
                <div class="storage-demo">
                    <h4>üíæ localStorage Practical: Query Builder</h4>
                    <p>Build and save your favorite API query combinations:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JavaScript - Query Builder Storage</span>
                            <button class="copy-btn" onclick="copyCode(this, 'storage-d2')">Copy</button>
                        </div>
                        <pre><code id="storage-d2">// Query Builder - Save your favorite queries
const QUERIES_KEY = 'day2_saved_queries';

// Save a query configuration
function saveQuery(name, params) {
    const queries = JSON.parse(localStorage.getItem(QUERIES_KEY)) || {};
    queries[name] = {
        params,
        createdAt: new Date().toISOString(),
        usageCount: 0
    };
    localStorage.setItem(QUERIES_KEY, JSON.stringify(queries));
    console.log(`‚úÖ Saved query: ${name}`);
}

// Get a saved query and build URL
function getQuery(name, baseUrl = '/api/products') {
    const queries = JSON.parse(localStorage.getItem(QUERIES_KEY)) || {};
    if (!queries[name]) {
        console.log(`‚ùå Query "${name}" not found`);
        return null;
    }
    queries[name].usageCount++;
    localStorage.setItem(QUERIES_KEY, JSON.stringify(queries));
    
    const queryString = new URLSearchParams(queries[name].params).toString();
    return `${baseUrl}?${queryString}`;
}

// List all saved queries
function listQueries() {
    const queries = JSON.parse(localStorage.getItem(QUERIES_KEY)) || {};
    console.table(Object.entries(queries).map(([name, data]) => ({
        name,
        params: JSON.stringify(data.params),
        usageCount: data.usageCount
    })));
}

// Usage:
saveQuery('cheap-electronics', { category: 'electronics', maxPrice: 200, sort: 'price' });
saveQuery('in-stock-office', { category: 'office', inStock: 'true' });
console.log(getQuery('cheap-electronics')); // /api/products?category=electronics&maxPrice=200&sort=price
listQueries();
</code></pre>
                    </div>
                </div>

                <div class="exercise">
                    <h4>üèãÔ∏è Exercise: Build a Blog API with Nested Comments</h4>
                    <p><strong>Scenario:</strong> You're building a blog platform with posts and comments.</p>
                    <p><strong>Task:</strong> Create nested endpoints for posts and their comments.</p>
                    <p><strong>Requirements:</strong></p>
                    <ul>
                        <li>GET /api/posts - List all posts with filtering by author</li>
                        <li>GET /api/posts/:postId/comments - Get comments for a post</li>
                        <li>POST /api/posts/:postId/comments - Add comment to a post</li>
                    </ul>
                    
                    <details>
                        <summary>üí° Hint</summary>
                        <p>Use <code>req.query.author</code> for filtering and <code>req.params.postId</code> for the nested relationship.</p>
                    </details>
                    
                    <details>
                        <summary>‚úÖ Solution</summary>
                        <div class="code-block">
                            <div class="code-header">
                                <span>JavaScript - Blog API Solution</span>
                                <button class="copy-btn" onclick="copyCode(this, 'solution-d2')">Copy</button>
                            </div>
                            <pre><code id="solution-d2">const express = require('express');
const app = express();
app.use(express.json());

let posts = [
    { id: 1, title: 'Intro to REST', author: 'alice', content: 'REST basics...' },
    { id: 2, title: 'Advanced APIs', author: 'bob', content: 'Advanced patterns...' }
];

let comments = [
    { id: 1, postId: 1, author: 'bob', text: 'Great article!' },
    { id: 2, postId: 1, author: 'charlie', text: 'Very helpful' }
];

// GET posts with optional author filter
app.get('/api/posts', (req, res) => {
    let result = [...posts];
    if (req.query.author) {
        result = result.filter(p => p.author === req.query.author);
    }
    res.json(result);
});

// GET comments for a post
app.get('/api/posts/:postId/comments', (req, res) => {
    const postId = parseInt(req.params.postId);
    const post = posts.find(p => p.id === postId);
    if (!post) return res.status(404).json({ error: 'Post not found' });
    
    const postComments = comments.filter(c => c.postId === postId);
    res.json(postComments);
});

// POST new comment
app.post('/api/posts/:postId/comments', (req, res) => {
    const postId = parseInt(req.params.postId);
    const post = posts.find(p => p.id === postId);
    if (!post) return res.status(404).json({ error: 'Post not found' });
    
    const newComment = {
        id: comments.length + 1,
        postId: postId,
        author: req.body.author,
        text: req.body.text
    };
    comments.push(newComment);
    res.status(201).json(newComment);
});

app.listen(3000);
</code></pre>
                        </div>
                    </details>
                </div>
                
                <div class="quiz">
                    <h3>‚úÖ Check Your Knowledge</h3>
                    
                    <div class="quiz-question">
                        <p><strong>Q1:</strong> What's the correct URL to get all orders for user 42?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d2q1" value="a"> A) /api/orders?userId=42</label>
                            <label><input type="radio" name="d2q1" value="b"> B) /api/users/42/orders</label>
                            <label><input type="radio" name="d2q1" value="c"> C) /api/getOrdersByUser/42</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d2q1', 'b', 'd2q1-fb')">Check Answer</button>
                        <div class="feedback" id="d2q1-fb"></div>
                    </div>
                    
                    <div class="quiz-question">
                        <p><strong>Q2:</strong> How should you implement pagination in a REST API?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d2q2" value="a"> A) POST /api/products/page/2</label>
                            <label><input type="radio" name="d2q2" value="b"> B) GET /api/products?page=2&limit=10</label>
                            <label><input type="radio" name="d2q2" value="c"> C) GET /api/products/paginate/2/10</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d2q2', 'b', 'd2q2-fb')">Check Answer</button>
                        <div class="feedback" id="d2q2-fb"></div>
                    </div>
                </div>
                
                <div class="takeaways">
                    <h3>üéØ Key Takeaways</h3>
                    <ul>
                        <li>Use plural nouns for resources (/users not /user)</li>
                        <li>Express relationships through URL hierarchy (/users/123/orders)</li>
                        <li>Use query parameters for filtering, sorting, and pagination</li>
                        <li>Keep URLs lowercase with hyphens, avoid verbs</li>
                    </ul>
                    <p><strong>Tomorrow:</strong> Request/Response handling - headers, content negotiation, and body parsing.</p>
                </div>
                
                <button class="complete-day" onclick="completeDay(2)">‚úì Mark Day 2 Complete</button>
            </div>

            <!-- DAY 3 CONTENT -->
            <div id="day3" class="day-content">
                <h2>üìò Day 3: Error Handling & Status Codes</h2>
                
                <div class="objectives">
                    <h3>üéØ Learning Objectives</h3>
                    <ul>
                        <li>Master HTTP status codes and when to use each</li>
                        <li>Implement consistent error response formats</li>
                        <li>Create centralized error handling middleware</li>
                        <li>Handle validation errors gracefully</li>
                        <li>Implement proper error logging</li>
                    </ul>
                </div>
                
                <h3>üìö HTTP Status Codes Reference</h3>
                
                <table>
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>When to Use</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>200</td><td>OK</td><td>Successful GET, PUT, PATCH</td></tr>
                        <tr><td>201</td><td>Created</td><td>Successful POST that creates resource</td></tr>
                        <tr><td>204</td><td>No Content</td><td>Successful DELETE (no body)</td></tr>
                        <tr><td>400</td><td>Bad Request</td><td>Invalid syntax, validation error</td></tr>
                        <tr><td>401</td><td>Unauthorized</td><td>Authentication required/failed</td></tr>
                        <tr><td>403</td><td>Forbidden</td><td>Authenticated but not permitted</td></tr>
                        <tr><td>404</td><td>Not Found</td><td>Resource doesn't exist</td></tr>
                        <tr><td>409</td><td>Conflict</td><td>Resource conflict (duplicate)</td></tr>
                        <tr><td>422</td><td>Unprocessable</td><td>Valid syntax but semantic error</td></tr>
                        <tr><td>500</td><td>Server Error</td><td>Unexpected server error</td></tr>
                    </tbody>
                </table>
                
                <h3>üíª Code Examples</h3>
                
                <h4>1. Consistent Error Response Format</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Error Response Structure</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d3-1')">Copy</button>
                    </div>
                    <pre><code id="code-d3-1">// Custom Error class for API errors
class ApiError extends Error {
    constructor(statusCode, message, details = null) {
        super(message);
        this.statusCode = statusCode;
        this.details = details;
        this.timestamp = new Date().toISOString();
    }

    toJSON() {
        return {
            error: {
                status: this.statusCode,
                message: this.message,
                details: this.details,
                timestamp: this.timestamp
            }
        };
    }
}

// Factory functions for common errors
const Errors = {
    notFound: (resource) => new ApiError(404, `${resource} not found`),
    badRequest: (message, details) => new ApiError(400, message, details),
    unauthorized: () => new ApiError(401, 'Authentication required'),
    forbidden: () => new ApiError(403, 'You do not have permission'),
    conflict: (message) => new ApiError(409, message),
    validation: (errors) => new ApiError(422, 'Validation failed', errors),
    internal: () => new ApiError(500, 'Internal server error')
};

module.exports = { ApiError, Errors };
</code></pre>
                </div>
                
                <h4>2. Centralized Error Handling Middleware</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Error Middleware</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d3-2')">Copy</button>
                    </div>
                    <pre><code id="code-d3-2">const express = require('express');
const app = express();
app.use(express.json());

// Custom error class
class ApiError extends Error {
    constructor(statusCode, message, details = null) {
        super(message);
        this.statusCode = statusCode;
        this.details = details;
    }
}

// Sample data
let users = [{ id: 1, name: 'Alice', email: 'alice@example.com' }];

// Routes with proper error throwing
app.get('/api/users/:id', (req, res, next) => {
    try {
        const id = parseInt(req.params.id);
        if (isNaN(id)) {
            throw new ApiError(400, 'Invalid user ID format');
        }
        const user = users.find(u => u.id === id);
        if (!user) {
            throw new ApiError(404, 'User not found');
        }
        res.json(user);
    } catch (error) {
        next(error); // Pass to error handler
    }
});

app.post('/api/users', (req, res, next) => {
    try {
        const { name, email } = req.body;
        const errors = [];
        
        if (!name || name.trim().length < 2) {
            errors.push({ field: 'name', message: 'Name must be at least 2 characters' });
        }
        if (!email || !email.includes('@')) {
            errors.push({ field: 'email', message: 'Valid email required' });
        }
        if (users.find(u => u.email === email)) {
            throw new ApiError(409, 'Email already exists');
        }
        
        if (errors.length > 0) {
            throw new ApiError(422, 'Validation failed', errors);
        }
        
        const newUser = { id: users.length + 1, name, email };
        users.push(newUser);
        res.status(201).json(newUser);
    } catch (error) {
        next(error);
    }
});

// 404 handler for undefined routes
app.use((req, res, next) => {
    next(new ApiError(404, `Route ${req.method} ${req.path} not found`));
});

// Global error handler (MUST be last middleware)
app.use((error, req, res, next) => {
    console.error(`[${new Date().toISOString()}] Error:`, error.message);
    
    const statusCode = error.statusCode || 500;
    const response = {
        error: {
            status: statusCode,
            message: error.message || 'Internal server error',
            ...(error.details && { details: error.details }),
            path: req.path,
            timestamp: new Date().toISOString()
        }
    };
    
    // Don't expose internal errors in production
    if (statusCode === 500 && process.env.NODE_ENV === 'production') {
        response.error.message = 'Internal server error';
    }
    
    res.status(statusCode).json(response);
});

app.listen(3000, () => console.log('Server running'));
</code></pre>
                </div>

                <div class="storage-demo">
                    <h4>üíæ localStorage Practical: Error Log Dashboard</h4>
                    <p>Track and analyze API errors for debugging:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JavaScript - Error Logger</span>
                            <button class="copy-btn" onclick="copyCode(this, 'storage-d3')">Copy</button>
                        </div>
                        <pre><code id="storage-d3">// Error Log Dashboard - Track API errors
const ERROR_LOG_KEY = 'day3_error_log';
const MAX_LOGS = 100;

// Log an error
function logError(statusCode, message, endpoint) {
    const logs = JSON.parse(localStorage.getItem(ERROR_LOG_KEY)) || [];
    logs.unshift({
        id: Date.now(),
        statusCode,
        message,
        endpoint,
        timestamp: new Date().toISOString()
    });
    // Keep only last 100 errors
    if (logs.length > MAX_LOGS) logs.pop();
    localStorage.setItem(ERROR_LOG_KEY, JSON.stringify(logs));
}

// Get error statistics
function getErrorStats() {
    const logs = JSON.parse(localStorage.getItem(ERROR_LOG_KEY)) || [];
    const stats = {
        total: logs.length,
        byStatusCode: {},
        byEndpoint: {},
        last24h: 0
    };
    
    const oneDayAgo = Date.now() - (24 * 60 * 60 * 1000);
    
    logs.forEach(log => {
        stats.byStatusCode[log.statusCode] = (stats.byStatusCode[log.statusCode] || 0) + 1;
        stats.byEndpoint[log.endpoint] = (stats.byEndpoint[log.endpoint] || 0) + 1;
        if (new Date(log.timestamp).getTime() > oneDayAgo) stats.last24h++;
    });
    
    return stats;
}

// Get recent errors
function getRecentErrors(count = 10) {
    const logs = JSON.parse(localStorage.getItem(ERROR_LOG_KEY)) || [];
    return logs.slice(0, count);
}

// Clear old errors
function clearErrors() {
    localStorage.removeItem(ERROR_LOG_KEY);
    console.log('üóëÔ∏è Error logs cleared');
}

// Usage
logError(404, 'User not found', '/api/users/999');
logError(400, 'Invalid email format', '/api/users');
logError(500, 'Database connection failed', '/api/orders');
console.log('Stats:', getErrorStats());
console.table(getRecentErrors(5));
</code></pre>
                    </div>
                </div>
                
                <div class="exercise">
                    <h4>üèãÔ∏è Exercise: Build Robust Error Handling</h4>
                    <p><strong>Task:</strong> Create a products API with comprehensive error handling.</p>
                    <ul>
                        <li>Return 400 for invalid price (must be positive number)</li>
                        <li>Return 404 for non-existent products</li>
                        <li>Return 409 for duplicate product names</li>
                        <li>Return 422 for missing required fields</li>
                    </ul>
                    
                    <details>
                        <summary>‚úÖ Solution</summary>
                        <div class="code-block">
                            <div class="code-header">
                                <span>JavaScript - Products with Error Handling</span>
                                <button class="copy-btn" onclick="copyCode(this, 'solution-d3')">Copy</button>
                            </div>
                            <pre><code id="solution-d3">const express = require('express');
const app = express();
app.use(express.json());

class ApiError extends Error {
    constructor(statusCode, message, details) {
        super(message);
        this.statusCode = statusCode;
        this.details = details;
    }
}

let products = [{ id: 1, name: 'Laptop', price: 999 }];

app.post('/api/products', (req, res, next) => {
    try {
        const { name, price } = req.body;
        const errors = [];
        
        if (!name) errors.push({ field: 'name', message: 'Name is required' });
        if (price === undefined) errors.push({ field: 'price', message: 'Price is required' });
        if (errors.length) throw new ApiError(422, 'Validation failed', errors);
        
        if (typeof price !== 'number' || price <= 0) {
            throw new ApiError(400, 'Price must be a positive number');
        }
        
        if (products.find(p => p.name.toLowerCase() === name.toLowerCase())) {
            throw new ApiError(409, 'Product with this name already exists');
        }
        
        const product = { id: products.length + 1, name, price };
        products.push(product);
        res.status(201).json(product);
    } catch (error) {
        next(error);
    }
});

app.use((err, req, res, next) => {
    res.status(err.statusCode || 500).json({
        error: { status: err.statusCode, message: err.message, details: err.details }
    });
});

app.listen(3000);
</code></pre>
                        </div>
                    </details>
                </div>
                
                <div class="quiz">
                    <h3>‚úÖ Check Your Knowledge</h3>
                    
                    <div class="quiz-question">
                        <p><strong>Q1:</strong> What status code indicates the client sent invalid data?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d3q1" value="a"> A) 401 Unauthorized</label>
                            <label><input type="radio" name="d3q1" value="b"> B) 400 Bad Request</label>
                            <label><input type="radio" name="d3q1" value="c"> C) 404 Not Found</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d3q1', 'b', 'd3q1-fb')">Check Answer</button>
                        <div class="feedback" id="d3q1-fb"></div>
                    </div>
                    
                    <div class="quiz-question">
                        <p><strong>Q2:</strong> When should you return 409 Conflict?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d3q2" value="a"> A) User not authenticated</label>
                            <label><input type="radio" name="d3q2" value="b"> B) Resource doesn't exist</label>
                            <label><input type="radio" name="d3q2" value="c"> C) Duplicate resource (e.g., email exists)</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d3q2', 'c', 'd3q2-fb')">Check Answer</button>
                        <div class="feedback" id="d3q2-fb"></div>
                    </div>
                </div>
                
                <div class="takeaways">
                    <h3>üéØ Key Takeaways</h3>
                    <ul>
                        <li>Use appropriate status codes: 4xx for client errors, 5xx for server errors</li>
                        <li>Create consistent error response format across your API</li>
                        <li>Centralize error handling with middleware</li>
                        <li>Never expose internal errors to clients in production</li>
                    </ul>
                    <p><strong>Tomorrow:</strong> Authentication & Authorization - JWT, API keys, and protecting routes.</p>
                </div>
                
                <button class="complete-day" onclick="completeDay(3)">‚úì Mark Day 3 Complete</button>
            </div>

            <!-- DAY 4 CONTENT -->
            <div id="day4" class="day-content">
                <h2>üìò Day 4: Authentication & Authorization</h2>

                <div class="objectives">
                    <h3>üéØ Learning Objectives</h3>
                    <ul>
                        <li>Understand the difference between authentication and authorization</li>
                        <li>Implement JWT-based authentication</li>
                        <li>Create protected routes with middleware</li>
                        <li>Build role-based access control (RBAC)</li>
                        <li>Secure API endpoints properly</li>
                    </ul>
                </div>

                <h3>üìö Core Concepts</h3>

                <div class="concept-grid">
                    <div class="concept-card">
                        <h4>üîê Authentication</h4>
                        <p>Verifies WHO you are. "Prove your identity." Examples: username/password, JWT tokens, OAuth.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üõ°Ô∏è Authorization</h4>
                        <p>Determines WHAT you can do. "Are you allowed to access this resource?" Examples: admin vs user roles.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üé´ JWT</h4>
                        <p>Self-contained token with encoded user data. Stateless - server doesn't store sessions.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üîë API Keys</h4>
                        <p>Simple tokens for service-to-service auth. Easy to implement but less secure than JWT for users.</p>
                    </div>
                </div>
                
                <h3>üíª Code Examples</h3>
                
                <h4>1. JWT Authentication System</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - JWT Auth (npm install jsonwebtoken bcryptjs)</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d4-1')">Copy</button>
                    </div>
                    <pre><code id="code-d4-1">const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

const app = express();
app.use(express.json());

const JWT_SECRET = 'your-secret-key-change-in-production';
const JWT_EXPIRES = '24h';

// Simulated user database
let users = [];

// Register new user
app.post('/api/auth/register', async (req, res) => {
    try {
        const { email, password, role = 'user' } = req.body;
        
        if (users.find(u => u.email === email)) {
            return res.status(409).json({ error: 'Email already registered' });
        }
        
        const hashedPassword = await bcrypt.hash(password, 10);
        const user = {
            id: users.length + 1,
            email,
            password: hashedPassword,
            role
        };
        users.push(user);
        
        const token = jwt.sign(
            { id: user.id, email: user.email, role: user.role },
            JWT_SECRET,
            { expiresIn: JWT_EXPIRES }
        );
        
        res.status(201).json({
            message: 'User registered successfully',
            token,
            user: { id: user.id, email: user.email, role: user.role }
        });
    } catch (error) {
        res.status(500).json({ error: 'Registration failed' });
    }
});

// Login
app.post('/api/auth/login', async (req, res) => {
    try {
        const { email, password } = req.body;
        const user = users.find(u => u.email === email);
        
        if (!user || !(await bcrypt.compare(password, user.password))) {
            return res.status(401).json({ error: 'Invalid credentials' });
        }
        
        const token = jwt.sign(
            { id: user.id, email: user.email, role: user.role },
            JWT_SECRET,
            { expiresIn: JWT_EXPIRES }
        );
        
        res.json({
            message: 'Login successful',
            token,
            user: { id: user.id, email: user.email, role: user.role }
        });
    } catch (error) {
        res.status(500).json({ error: 'Login failed' });
    }
});

// Auth middleware
const authenticate = (req, res, next) => {
    const authHeader = req.headers.authorization;
    
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
        return res.status(401).json({ error: 'No token provided' });
    }
    
    const token = authHeader.split(' ')[1];
    
    try {
        const decoded = jwt.verify(token, JWT_SECRET);
        req.user = decoded;
        next();
    } catch (error) {
        res.status(401).json({ error: 'Invalid or expired token' });
    }
};

// Protected route
app.get('/api/profile', authenticate, (req, res) => {
    res.json({
        message: 'Protected data',
        user: req.user
    });
});

app.listen(3000, () => console.log('Auth server running'));
</code></pre>
                </div>
                
                <h4>2. Role-Based Access Control (RBAC)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - RBAC Middleware</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d4-2')">Copy</button>
                    </div>
                    <pre><code id="code-d4-2">// Role-based authorization middleware
const authorize = (...allowedRoles) => {
    return (req, res, next) => {
        if (!req.user) {
            return res.status(401).json({ error: 'Authentication required' });
        }
        
        if (!allowedRoles.includes(req.user.role)) {
            return res.status(403).json({ 
                error: 'Forbidden',
                message: `Role '${req.user.role}' cannot access this resource`
            });
        }
        
        next();
    };
};

// Usage examples:
// Anyone authenticated can access
app.get('/api/dashboard', authenticate, (req, res) => {
    res.json({ message: 'Dashboard data' });
});

// Only admins can access
app.get('/api/admin/users', authenticate, authorize('admin'), (req, res) => {
    res.json({ users: users.map(u => ({ id: u.id, email: u.email, role: u.role })) });
});

// Admins and managers can access
app.get('/api/reports', authenticate, authorize('admin', 'manager'), (req, res) => {
    res.json({ message: 'Reports data' });
});

// Resource ownership check
const authorizeOwner = (req, res, next) => {
    const resourceUserId = parseInt(req.params.userId);
    
    if (req.user.role === 'admin') {
        return next(); // Admins can access any resource
    }
    
    if (req.user.id !== resourceUserId) {
        return res.status(403).json({ error: 'You can only access your own resources' });
    }
    
    next();
};

// Users can only update their own profile
app.put('/api/users/:userId', authenticate, authorizeOwner, (req, res) => {
    res.json({ message: 'Profile updated' });
});
</code></pre>
                </div>

                <div class="storage-demo">
                    <h4>üíæ localStorage Practical: Token Manager</h4>
                    <p>Manage JWT tokens client-side:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JavaScript - Token Manager</span>
                            <button class="copy-btn" onclick="copyCode(this, 'storage-d4')">Copy</button>
                        </div>
                        <pre><code id="storage-d4">// Token Manager - Client-side JWT handling
const TOKEN_KEY = 'day4_auth_token';
const USER_KEY = 'day4_user_data';

// Save token after login
function saveAuth(token, user) {
    localStorage.setItem(TOKEN_KEY, token);
    localStorage.setItem(USER_KEY, JSON.stringify(user));
    console.log('‚úÖ Auth saved for:', user.email);
}

// Get token for API requests
function getToken() {
    return localStorage.getItem(TOKEN_KEY);
}

// Get current user
function getCurrentUser() {
    const userData = localStorage.getItem(USER_KEY);
    return userData ? JSON.parse(userData) : null;
}

// Check if token is expired (decode JWT without verification)
function isTokenExpired() {
    const token = getToken();
    if (!token) return true;
    
    try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        return payload.exp * 1000 < Date.now();
    } catch {
        return true;
    }
}

// Create authenticated fetch helper
async function authFetch(url, options = {}) {
    const token = getToken();
    if (!token || isTokenExpired()) {
        throw new Error('Authentication required');
    }
    
    return fetch(url, {
        ...options,
        headers: {
            ...options.headers,
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        }
    });
}

// Logout - clear all auth data
function logout() {
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(USER_KEY);
    console.log('üëã Logged out');
}

// Usage example:
saveAuth('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...', { id: 1, email: 'test@example.com', role: 'user' });
console.log('Current user:', getCurrentUser());
console.log('Token expired?', isTokenExpired());
</code></pre>
                    </div>
                </div>
                
                <div class="exercise">
                    <h4>üèãÔ∏è Exercise: Build Protected Todo API</h4>
                    <p><strong>Task:</strong> Create a Todo API where users can only access their own todos.</p>
                    <ul>
                        <li>POST /api/auth/register - Create account</li>
                        <li>POST /api/auth/login - Get JWT token</li>
                        <li>GET /api/todos - List user's todos only</li>
                        <li>POST /api/todos - Create todo for logged-in user</li>
                    </ul>
                    
                    <details>
                        <summary>‚úÖ Solution</summary>
                        <div class="code-block">
                            <div class="code-header">
                                <span>JavaScript - Protected Todo API</span>
                                <button class="copy-btn" onclick="copyCode(this, 'solution-d4')">Copy</button>
                            </div>
                            <pre><code id="solution-d4">const express = require('express');
const jwt = require('jsonwebtoken');
const app = express();
app.use(express.json());

const SECRET = 'todo-secret';
let users = [];
let todos = [];

const auth = (req, res, next) => {
    const token = req.headers.authorization?.split(' ')[1];
    if (!token) return res.status(401).json({ error: 'No token' });
    try {
        req.user = jwt.verify(token, SECRET);
        next();
    } catch { res.status(401).json({ error: 'Invalid token' }); }
};

app.post('/api/auth/register', (req, res) => {
    const { email, password } = req.body;
    if (users.find(u => u.email === email)) {
        return res.status(409).json({ error: 'Email exists' });
    }
    const user = { id: users.length + 1, email, password };
    users.push(user);
    const token = jwt.sign({ id: user.id, email }, SECRET, { expiresIn: '1h' });
    res.status(201).json({ token });
});

app.post('/api/auth/login', (req, res) => {
    const { email, password } = req.body;
    const user = users.find(u => u.email === email && u.password === password);
    if (!user) return res.status(401).json({ error: 'Invalid credentials' });
    const token = jwt.sign({ id: user.id, email }, SECRET, { expiresIn: '1h' });
    res.json({ token });
});

app.get('/api/todos', auth, (req, res) => {
    const userTodos = todos.filter(t => t.userId === req.user.id);
    res.json(userTodos);
});

app.post('/api/todos', auth, (req, res) => {
    const todo = {
        id: todos.length + 1,
        userId: req.user.id,
        title: req.body.title,
        completed: false
    };
    todos.push(todo);
    res.status(201).json(todo);
});

app.listen(3000);
</code></pre>
                        </div>
                    </details>
                </div>
                
                <div class="quiz">
                    <h3>‚úÖ Check Your Knowledge</h3>
                    
                    <div class="quiz-question">
                        <p><strong>Q1:</strong> What's the difference between 401 and 403 status codes?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d4q1" value="a"> A) 401 = not logged in, 403 = logged in but not permitted</label>
                            <label><input type="radio" name="d4q1" value="b"> B) 401 = server error, 403 = client error</label>
                            <label><input type="radio" name="d4q1" value="c"> C) They mean the same thing</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d4q1', 'a', 'd4q1-fb')">Check Answer</button>
                        <div class="feedback" id="d4q1-fb"></div>
                    </div>
                    
                    <div class="quiz-question">
                        <p><strong>Q2:</strong> Where should you send a JWT token in API requests?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d4q2" value="a"> A) In the URL query string</label>
                            <label><input type="radio" name="d4q2" value="b"> B) In the Authorization header as "Bearer {token}"</label>
                            <label><input type="radio" name="d4q2" value="c"> C) In the request body</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d4q2', 'b', 'd4q2-fb')">Check Answer</button>
                        <div class="feedback" id="d4q2-fb"></div>
                    </div>
                </div>
                
                <div class="takeaways">
                    <h3>üéØ Key Takeaways</h3>
                    <ul>
                        <li>Authentication verifies identity; Authorization determines permissions</li>
                        <li>JWT tokens are stateless and self-contained</li>
                        <li>Use middleware to protect routes and check roles</li>
                        <li>Always hash passwords - never store plain text</li>
                    </ul>
                    <p><strong>Tomorrow:</strong> API Versioning - strategies for evolving your API without breaking clients.</p>
                </div>
                
                <button class="complete-day" onclick="completeDay(4)">‚úì Mark Day 4 Complete</button>
            </div>

            <!-- DAY 5 CONTENT -->
            <div id="day5" class="day-content">
                <h2>üìò Day 5: API Versioning & Evolution</h2>

                <div class="objectives">
                    <h3>üéØ Learning Objectives</h3>
                    <ul>
                        <li>Understand different API versioning strategies</li>
                        <li>Implement URI, header, and content negotiation versioning</li>
                        <li>Handle breaking vs non-breaking changes</li>
                        <li>Create deprecation strategies for old API versions</li>
                        <li>Design backward-compatible APIs</li>
                    </ul>
                </div>

                <h3>üìö Core Concepts</h3>

                <div class="concept-grid">
                    <div class="concept-card">
                        <h4>üìç URI Versioning</h4>
                        <p>Version in the URL path (/api/v1/users, /api/v2/users). Most visible and explicit. Easy for developers to understand.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üìã Header Versioning</h4>
                        <p>Version specified in Accept header (Accept: application/vnd.api+json; version=2). Cleaner URLs but less discoverable.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üîÑ Breaking Changes</h4>
                        <p>Changes that break existing clients: removing fields, changing types, renaming endpoints. Require new major version.</p>
                    </div>
                    <div class="concept-card">
                        <h4>‚ö†Ô∏è Deprecation</h4>
                        <p>Gradual phase-out of old versions. Use Sunset header, provide migration guides, maintain overlap period.</p>
                    </div>
                </div>

                <h3>üíª Code Examples</h3>

                <h4>1. URI Versioning Implementation</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - URI Versioning</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d5-1')">Copy</button>
                    </div>
                    <pre><code id="code-d5-1">const express = require('express');
const app = express();
app.use(express.json());

// Sample data
let users = [
    { id: 1, name: 'Alice', email: 'alice@example.com' }
];

// V1 API - Original version
app.get('/api/v1/users', (req, res) => {
    // V1 returns simple format
    res.json(users);
});

app.get('/api/v1/users/:id', (req, res) => {
    const user = users.find(u => u.id === parseInt(req.params.id));
    if (!user) return res.status(404).json({ error: 'User not found' });
    res.json(user);
});

// V2 API - Enhanced with metadata and HATEOAS
app.get('/api/v2/users', (req, res) => {
    // V2 returns enhanced format with metadata
    res.json({
        version: '2.0',
        data: users,
        metadata: {
            total: users.length,
            page: 1,
            perPage: 10
        },
        _links: {
            self: '/api/v2/users',
            docs: '/api/v2/docs'
        }
    });
});

app.get('/api/v2/users/:id', (req, res) => {
    const user = users.find(u => u.id === parseInt(req.params.id));
    if (!user) return res.status(404).json({ error: 'User not found' });

    // V2 includes hypermedia links
    res.json({
        version: '2.0',
        data: user,
        _links: {
            self: `/api/v2/users/${user.id}`,
            update: `/api/v2/users/${user.id}`,
            delete: `/api/v2/users/${user.id}`
        }
    });
});

// Version middleware to handle unversioned requests
app.use('/api/users*', (req, res, next) => {
    res.status(400).json({
        error: 'API version required',
        message: 'Please specify version in URL (e.g., /api/v2/users)',
        supportedVersions: ['v1', 'v2']
    });
});

app.listen(3000, () => console.log('Versioned API running'));
</code></pre>
                </div>

                <h4>2. Header-Based Versioning</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Header Versioning</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d5-2')">Copy</button>
                    </div>
                    <pre><code id="code-d5-2">const express = require('express');
const app = express();
app.use(express.json());

// Middleware to extract API version from header
const apiVersion = (req, res, next) => {
    // Check Accept-Version header
    const version = req.headers['accept-version'] ||
                   req.headers['api-version'] ||
                   '1.0';

    req.apiVersion = parseFloat(version);

    // Set response header indicating version used
    res.set('API-Version', version);

    next();
};

app.use(apiVersion);

// Single endpoint that adapts based on version
app.get('/api/users', (req, res) => {
    const users = [
        { id: 1, firstName: 'Alice', lastName: 'Johnson', email: 'alice@example.com' }
    ];

    if (req.apiVersion < 2.0) {
        // V1 format: combined name
        const v1Users = users.map(u => ({
            id: u.id,
            name: `${u.firstName} ${u.lastName}`,
            email: u.email
        }));
        return res.json(v1Users);
    } else {
        // V2 format: separate firstName/lastName
        return res.json({
            version: req.apiVersion,
            data: users,
            _links: { self: '/api/users' }
        });
    }
});

// Deprecation middleware for old versions
const checkDeprecation = (req, res, next) => {
    if (req.apiVersion < 1.5) {
        res.set('Warning', '299 - "API version deprecated. Please upgrade to v2.0"');
        res.set('Sunset', 'Sat, 31 Dec 2024 23:59:59 GMT');
        res.set('Link', '</api/docs/migration>; rel="deprecation"');
    }
    next();
};

app.use(checkDeprecation);

app.listen(3000, () => console.log('Header-versioned API running'));

// Example usage:
// curl -H "Accept-Version: 1.0" http://localhost:3000/api/users
// curl -H "Accept-Version: 2.0" http://localhost:3000/api/users
</code></pre>
                </div>

                <h4>3. Content Negotiation Versioning</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Content Negotiation</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d5-3')">Copy</button>
                    </div>
                    <pre><code id="code-d5-3">const express = require('express');
const app = express();
app.use(express.json());

// Parse custom media types
const parseAcceptHeader = (acceptHeader) => {
    // Example: application/vnd.myapi.v2+json
    const match = acceptHeader.match(/application\/vnd\.myapi\.v(\d+)\+json/);
    return match ? parseInt(match[1]) : 1;
};

app.get('/api/users', (req, res) => {
    const acceptHeader = req.headers.accept || 'application/json';
    const version = parseAcceptHeader(acceptHeader);

    const users = [
        { id: 1, name: 'Alice', email: 'alice@example.com', createdAt: '2024-01-01' }
    ];

    switch(version) {
        case 1:
            // V1: Basic format
            res.set('Content-Type', 'application/vnd.myapi.v1+json');
            return res.json(users.map(({ id, name, email }) => ({ id, name, email })));

        case 2:
            // V2: Enhanced format with timestamps
            res.set('Content-Type', 'application/vnd.myapi.v2+json');
            return res.json({
                version: 2,
                data: users,
                metadata: { count: users.length }
            });

        default:
            return res.status(406).json({
                error: 'Not Acceptable',
                message: `API version ${version} not supported`,
                supportedVersions: [
                    'application/vnd.myapi.v1+json',
                    'application/vnd.myapi.v2+json'
                ]
            });
    }
});

app.listen(3000, () => console.log('Content negotiation API running'));

// Example usage:
// curl -H "Accept: application/vnd.myapi.v1+json" http://localhost:3000/api/users
// curl -H "Accept: application/vnd.myapi.v2+json" http://localhost:3000/api/users
</code></pre>
                </div>

                <div class="storage-demo">
                    <h4>üíæ localStorage Practical: API Version Manager</h4>
                    <p>Track and manage API version compatibility on the client side:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JavaScript - Version Manager</span>
                            <button class="copy-btn" onclick="copyCode(this, 'storage-d5')">Copy</button>
                        </div>
                        <pre><code id="storage-d5">// API Version Manager - Handle version compatibility
const VERSION_KEY = 'day5_api_version';
const VERSION_HISTORY_KEY = 'day5_version_history';

class APIVersionManager {
    constructor() {
        this.currentVersion = this.loadVersion() || '2.0';
        this.minSupportedVersion = '1.0';
        this.maxSupportedVersion = '2.0';
    }

    // Load saved version preference
    loadVersion() {
        return localStorage.getItem(VERSION_KEY);
    }

    // Set preferred API version
    setVersion(version) {
        if (!this.isVersionSupported(version)) {
            throw new Error(`Version ${version} not supported`);
        }
        this.currentVersion = version;
        localStorage.setItem(VERSION_KEY, version);
        this.logVersionChange(version);
        console.log(`‚úÖ API version set to ${version}`);
    }

    // Check if version is supported
    isVersionSupported(version) {
        const v = parseFloat(version);
        return v >= parseFloat(this.minSupportedVersion) &&
               v <= parseFloat(this.maxSupportedVersion);
    }

    // Get headers for API requests
    getHeaders() {
        return {
            'Accept-Version': this.currentVersion,
            'Accept': `application/vnd.myapi.v${this.currentVersion.split('.')[0]}+json`
        };
    }

    // Log version changes for debugging
    logVersionChange(version) {
        const history = JSON.parse(localStorage.getItem(VERSION_HISTORY_KEY)) || [];
        history.push({
            version,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent
        });
        if (history.length > 50) history.shift(); // Keep last 50
        localStorage.setItem(VERSION_HISTORY_KEY, JSON.stringify(history));
    }

    // Get version history
    getHistory() {
        return JSON.parse(localStorage.getItem(VERSION_HISTORY_KEY)) || [];
    }

    // Handle deprecation warnings
    handleDeprecation(response) {
        const warning = response.headers.get('Warning');
        const sunset = response.headers.get('Sunset');

        if (warning || sunset) {
            console.warn('‚ö†Ô∏è API Version Deprecation:');
            if (warning) console.warn(`Warning: ${warning}`);
            if (sunset) console.warn(`Sunset Date: ${sunset}`);

            // Show user notification
            this.notifyDeprecation(sunset);
        }
    }

    notifyDeprecation(sunsetDate) {
        const message = `This API version will be deprecated on ${sunsetDate}. Please upgrade.`;
        localStorage.setItem('api_deprecation_notice', message);
    }
}

// Usage
const apiVersion = new APIVersionManager();
console.log('Current version:', apiVersion.currentVersion);

// Make versioned request
async function fetchUsers() {
    const response = await fetch('/api/users', {
        headers: apiVersion.getHeaders()
    });

    // Check for deprecation
    apiVersion.handleDeprecation(response);

    return response.json();
}

// Change version
apiVersion.setVersion('2.0');
console.log('Version history:', apiVersion.getHistory());
</code></pre>
                    </div>
                </div>

                <div class="exercise">
                    <h4>üèãÔ∏è Exercise: Implement Breaking Changes Strategy</h4>
                    <p><strong>Scenario:</strong> You need to rename "email" to "emailAddress" and add a required "phoneNumber" field.</p>
                    <p><strong>Task:</strong> Implement both V1 and V2 endpoints that handle this breaking change gracefully.</p>
                    <p><strong>Requirements:</strong></p>
                    <ul>
                        <li>V1: Keep existing "email" field, phoneNumber optional</li>
                        <li>V2: Use "emailAddress" and require "phoneNumber"</li>
                        <li>Add deprecation headers to V1</li>
                        <li>Provide migration guide in V1 responses</li>
                    </ul>

                    <details>
                        <summary>üí° Hint</summary>
                        <p>Use separate route handlers for each version, and add transformation logic to map between old and new field names. Include migration info in V1 responses.</p>
                    </details>

                    <details>
                        <summary>‚úÖ Solution</summary>
                        <div class="code-block">
                            <div class="code-header">
                                <span>JavaScript - Breaking Changes Solution</span>
                                <button class="copy-btn" onclick="copyCode(this, 'solution-d5')">Copy</button>
                            </div>
                            <pre><code id="solution-d5">const express = require('express');
const app = express();
app.use(express.json());

// Internal data model (V2 structure)
let users = [
    { id: 1, name: 'Alice', emailAddress: 'alice@example.com', phoneNumber: '+1234567890' }
];

// V1 API - Deprecated
app.get('/api/v1/users', (req, res) => {
    // Add deprecation headers
    res.set('Warning', '299 - "API v1 deprecated. Migrate to v2 by 2024-12-31"');
    res.set('Sunset', 'Tue, 31 Dec 2024 23:59:59 GMT');
    res.set('Link', '</api/v2/migration>; rel="deprecation"');

    // Transform to V1 format
    const v1Users = users.map(u => ({
        id: u.id,
        name: u.name,
        email: u.emailAddress, // Map emailAddress back to email
        phoneNumber: u.phoneNumber || null // Optional in V1
    }));

    res.json({
        data: v1Users,
        _migration: {
            message: 'Please upgrade to v2',
            changes: [
                'Field "email" renamed to "emailAddress"',
                'Field "phoneNumber" is now required'
            ],
            migrationGuide: '/api/v2/migration'
        }
    });
});

app.post('/api/v1/users', (req, res) => {
    const { name, email, phoneNumber } = req.body;

    // Transform V1 request to V2 format
    const newUser = {
        id: users.length + 1,
        name,
        emailAddress: email, // Map email to emailAddress
        phoneNumber: phoneNumber || 'Not provided' // Handle optional
    };

    users.push(newUser);

    // Return in V1 format
    res.status(201).json({
        id: newUser.id,
        name: newUser.name,
        email: newUser.emailAddress,
        phoneNumber: newUser.phoneNumber
    });
});

// V2 API - Current
app.get('/api/v2/users', (req, res) => {
    res.json({
        version: '2.0',
        data: users
    });
});

app.post('/api/v2/users', (req, res) => {
    const { name, emailAddress, phoneNumber } = req.body;

    // Validate required fields for V2
    if (!name || !emailAddress || !phoneNumber) {
        return res.status(400).json({
            error: 'Validation failed',
            details: [
                !name && { field: 'name', message: 'Required' },
                !emailAddress && { field: 'emailAddress', message: 'Required' },
                !phoneNumber && { field: 'phoneNumber', message: 'Required in v2' }
            ].filter(Boolean)
        });
    }

    const newUser = {
        id: users.length + 1,
        name,
        emailAddress,
        phoneNumber
    };

    users.push(newUser);
    res.status(201).json({ version: '2.0', data: newUser });
});

app.listen(3000);
</code></pre>
                        </div>
                    </details>
                </div>

                <div class="quiz">
                    <h3>‚úÖ Check Your Knowledge</h3>

                    <div class="quiz-question">
                        <p><strong>Q1:</strong> Which versioning strategy is most visible and explicit for developers?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d5q1" value="a"> A) URI versioning (/api/v2/users)</label>
                            <label><input type="radio" name="d5q1" value="b"> B) Header versioning</label>
                            <label><input type="radio" name="d5q1" value="c"> C) Query parameter versioning</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d5q1', 'a', 'd5q1-fb')">Check Answer</button>
                        <div class="feedback" id="d5q1-fb"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Q2:</strong> Which HTTP header indicates when an API version will be sunset?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d5q2" value="a"> A) Deprecation</label>
                            <label><input type="radio" name="d5q2" value="b"> B) Sunset</label>
                            <label><input type="radio" name="d5q2" value="c"> C) Expires</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d5q2', 'b', 'd5q2-fb')">Check Answer</button>
                        <div class="feedback" id="d5q2-fb"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Q3:</strong> What type of change is considered "breaking"?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d5q3" value="a"> A) Adding a new optional field</label>
                            <label><input type="radio" name="d5q3" value="b"> B) Removing an existing field</label>
                            <label><input type="radio" name="d5q3" value="c"> C) Adding a new endpoint</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d5q3', 'b', 'd5q3-fb')">Check Answer</button>
                        <div class="feedback" id="d5q3-fb"></div>
                    </div>
                </div>

                <div class="takeaways">
                    <h3>üéØ Key Takeaways</h3>
                    <ul>
                        <li>URI versioning is most explicit; header versioning keeps URLs clean</li>
                        <li>Breaking changes (removing fields, changing types) require new major versions</li>
                        <li>Use Sunset and Warning headers to communicate deprecation</li>
                        <li>Maintain overlap period when deprecating old versions</li>
                        <li>Document migration paths clearly for clients</li>
                    </ul>
                    <p><strong>Tomorrow:</strong> Performance & Optimization - caching, rate limiting, and database optimization.</p>
                </div>

                <button class="complete-day" onclick="completeDay(5)">‚úì Mark Day 5 Complete</button>
            </div>

            <!-- DAY 6 CONTENT -->
            <div id="day6" class="day-content">
                <h2>üìò Day 6: Performance & Optimization</h2>

                <div class="objectives">
                    <h3>üéØ Learning Objectives</h3>
                    <ul>
                        <li>Implement caching strategies with Redis and HTTP cache headers</li>
                        <li>Optimize database queries and use connection pooling</li>
                        <li>Add rate limiting to prevent abuse</li>
                        <li>Use compression and pagination for large datasets</li>
                        <li>Monitor and measure API performance</li>
                    </ul>
                </div>

                <h3>üìö Core Concepts</h3>

                <div class="concept-grid">
                    <div class="concept-card">
                        <h4>üóÑÔ∏è Caching</h4>
                        <p>Store frequently accessed data in memory (Redis) or use HTTP cache headers (ETag, Cache-Control) to reduce server load.</p>
                    </div>
                    <div class="concept-card">
                        <h4>‚ö° Rate Limiting</h4>
                        <p>Limit requests per user/IP to prevent abuse. Use sliding windows, token buckets, or fixed windows strategies.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üîç Query Optimization</h4>
                        <p>Use indexes, select only needed fields, avoid N+1 queries, implement connection pooling for database efficiency.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üì¶ Compression</h4>
                        <p>Use gzip/brotli compression to reduce response size. Implement pagination for large collections.</p>
                    </div>
                </div>

                <h3>üíª Code Examples</h3>

                <h4>1. Redis Caching Implementation</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Redis Cache (npm install redis)</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d6-1')">Copy</button>
                    </div>
                    <pre><code id="code-d6-1">const express = require('express');
const redis = require('redis');
const app = express();

// Create Redis client
const redisClient = redis.createClient({
    host: 'localhost',
    port: 6379
});

redisClient.on('error', (err) => console.error('Redis error:', err));
redisClient.connect();

// Cache middleware
const cacheMiddleware = (duration) => {
    return async (req, res, next) => {
        const key = `cache:${req.originalUrl}`;

        try {
            // Check cache
            const cachedData = await redisClient.get(key);

            if (cachedData) {
                console.log('‚úÖ Cache hit');
                return res.json({
                    cached: true,
                    data: JSON.parse(cachedData)
                });
            }

            // Cache miss - store original res.json
            const originalJson = res.json.bind(res);

            res.json = (data) => {
                // Store in cache
                redisClient.setEx(key, duration, JSON.stringify(data))
                    .catch(err => console.error('Cache error:', err));

                originalJson(data);
            };

            next();
        } catch (error) {
            console.error('Cache middleware error:', error);
            next();
        }
    };
};

// Sample expensive operation
const getExpensiveData = async () => {
    // Simulate database query or API call
    await new Promise(resolve => setTimeout(resolve, 2000));
    return {
        users: [
            { id: 1, name: 'Alice', email: 'alice@example.com' },
            { id: 2, name: 'Bob', email: 'bob@example.com' }
        ],
        timestamp: new Date().toISOString()
    };
};

// Route with 60-second cache
app.get('/api/users', cacheMiddleware(60), async (req, res) => {
    console.log('üîç Fetching data from source...');
    const data = await getExpensiveData();
    res.json(data);
});

// Manual cache invalidation
app.post('/api/users', async (req, res) => {
    // Create user logic here...

    // Invalidate cache
    await redisClient.del('cache:/api/users');
    console.log('üóëÔ∏è Cache invalidated');

    res.status(201).json({ message: 'User created' });
});

// Clear all cache
app.post('/api/cache/clear', async (req, res) => {
    const keys = await redisClient.keys('cache:*');
    if (keys.length > 0) {
        await redisClient.del(keys);
    }
    res.json({ message: `Cleared ${keys.length} cache entries` });
});

app.listen(3000, () => console.log('Cached API running'));
</code></pre>
                </div>

                <h4>2. Rate Limiting with express-rate-limit</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Rate Limiting (npm install express-rate-limit)</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d6-2')">Copy</button>
                    </div>
                    <pre><code id="code-d6-2">const express = require('express');
const rateLimit = require('express-rate-limit');
const app = express();
app.use(express.json());

// General rate limiter - 100 requests per 15 minutes
const generalLimiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100, // Limit each IP to 100 requests per windowMs
    message: {
        error: 'Too many requests',
        message: 'You have exceeded the 100 requests in 15 minutes limit!',
        retryAfter: '15 minutes'
    },
    standardHeaders: true, // Return rate limit info in headers
    legacyHeaders: false,
    handler: (req, res) => {
        res.status(429).json({
            error: 'Too Many Requests',
            message: 'Rate limit exceeded. Please try again later.',
            retryAfter: req.rateLimit.resetTime
        });
    }
});

// Strict limiter for auth endpoints - 5 attempts per 15 minutes
const authLimiter = rateLimit({
    windowMs: 15 * 60 * 1000,
    max: 5,
    skipSuccessfulRequests: true, // Don't count successful requests
    message: {
        error: 'Too many login attempts',
        message: 'Account temporarily locked. Try again in 15 minutes.'
    }
});

// Custom rate limiter with Redis store
const RedisStore = require('rate-limit-redis');
const redis = require('redis');
const redisClient = redis.createClient();

const redisLimiter = rateLimit({
    store: new RedisStore({
        client: redisClient,
        prefix: 'rate_limit:'
    }),
    windowMs: 60 * 1000, // 1 minute
    max: 20 // 20 requests per minute per IP
});

// Apply general limiter to all routes
app.use('/api/', generalLimiter);

// Stricter limit for authentication
app.post('/api/auth/login', authLimiter, (req, res) => {
    // Login logic here
    res.json({ message: 'Login successful' });
});

// Different limits for different user tiers
const createTieredLimiter = (req, res, next) => {
    const userTier = req.user?.tier || 'free';

    const limits = {
        free: { windowMs: 60 * 60 * 1000, max: 100 },    // 100/hour
        premium: { windowMs: 60 * 60 * 1000, max: 1000 }, // 1000/hour
        enterprise: { windowMs: 60 * 60 * 1000, max: 10000 } // 10000/hour
    };

    const limiter = rateLimit(limits[userTier]);
    limiter(req, res, next);
};

app.get('/api/data', createTieredLimiter, (req, res) => {
    res.json({ data: 'Your data here' });
});

// Rate limit status endpoint
app.get('/api/rate-limit/status', (req, res) => {
    res.json({
        limit: req.rateLimit.limit,
        remaining: req.rateLimit.remaining,
        resetTime: new Date(req.rateLimit.resetTime)
    });
});

app.listen(3000, () => console.log('Rate-limited API running'));
</code></pre>
                </div>

                <h4>3. HTTP Cache Headers & ETags</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - HTTP Caching</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d6-3')">Copy</button>
                    </div>
                    <pre><code id="code-d6-3">const express = require('express');
const crypto = require('crypto');
const app = express();

// Generate ETag from content
const generateETag = (content) => {
    return crypto
        .createHash('md5')
        .update(JSON.stringify(content))
        .digest('hex');
};

// ETag middleware
const etagMiddleware = (req, res, next) => {
    const originalJson = res.json.bind(res);

    res.json = (data) => {
        const etag = generateETag(data);

        // Set ETag header
        res.set('ETag', etag);

        // Check if client has cached version
        const clientEtag = req.headers['if-none-match'];

        if (clientEtag === etag) {
            // Content hasn't changed
            return res.status(304).end();
        }

        // Send new content
        originalJson(data);
    };

    next();
};

app.use(etagMiddleware);

// Cache-Control headers for different content types
app.get('/api/static/config', (req, res) => {
    // Cache for 1 hour, can be stale
    res.set('Cache-Control', 'public, max-age=3600, stale-while-revalidate=86400');

    res.json({
        apiVersion: '2.0',
        features: ['auth', 'caching', 'rate-limiting']
    });
});

app.get('/api/users/:id', (req, res) => {
    // Private cache, must revalidate
    res.set('Cache-Control', 'private, max-age=300, must-revalidate');

    const user = {
        id: req.params.id,
        name: 'Alice',
        email: 'alice@example.com',
        lastModified: '2024-01-15T10:00:00Z'
    };

    // Also set Last-Modified header
    res.set('Last-Modified', new Date(user.lastModified).toUTCString());

    // Check If-Modified-Since header
    const ifModifiedSince = req.headers['if-modified-since'];
    if (ifModifiedSince) {
        const modifiedTime = new Date(user.lastModified).getTime();
        const requestTime = new Date(ifModifiedSince).getTime();

        if (modifiedTime <= requestTime) {
            return res.status(304).end();
        }
    }

    res.json(user);
});

// Never cache sensitive data
app.get('/api/auth/session', (req, res) => {
    res.set('Cache-Control', 'no-store, no-cache, must-revalidate, private');
    res.set('Pragma', 'no-cache');
    res.set('Expires', '0');

    res.json({ sessionId: 'abc123', expiresAt: new Date() });
});

// Conditional GET with ETag
app.get('/api/data', (req, res) => {
    const data = { users: [], timestamp: Date.now() };
    const etag = generateETag(data);

    res.set('ETag', etag);
    res.set('Cache-Control', 'max-age=60');

    if (req.headers['if-none-match'] === etag) {
        return res.status(304).end();
    }

    res.json(data);
});

app.listen(3000, () => console.log('HTTP cached API running'));
</code></pre>
                </div>

                <div class="storage-demo">
                    <h4>üíæ localStorage Practical: Client-Side Performance Tracking</h4>
                    <p>Monitor API performance and cache efficiency on the client:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JavaScript - Performance Monitor</span>
                            <button class="copy-btn" onclick="copyCode(this, 'storage-d6')">Copy</button>
                        </div>
                        <pre><code id="storage-d6">// Performance Tracker - Monitor API response times
const PERF_KEY = 'day6_performance_metrics';
const MAX_SAMPLES = 100;

class PerformanceMonitor {
    constructor() {
        this.metrics = this.loadMetrics();
    }

    loadMetrics() {
        const data = localStorage.getItem(PERF_KEY);
        return data ? JSON.parse(data) : {
            requests: [],
            cacheHits: 0,
            cacheMisses: 0
        };
    }

    saveMetrics() {
        // Keep only last 100 requests
        if (this.metrics.requests.length > MAX_SAMPLES) {
            this.metrics.requests = this.metrics.requests.slice(-MAX_SAMPLES);
        }
        localStorage.setItem(PERF_KEY, JSON.stringify(this.metrics));
    }

    // Wrap fetch to track performance
    async trackedFetch(url, options = {}) {
        const startTime = performance.now();
        const startMark = `fetch-start-${Date.now()}`;
        const endMark = `fetch-end-${Date.now()}`;

        performance.mark(startMark);

        try {
            const response = await fetch(url, options);
            performance.mark(endMark);

            const duration = performance.now() - startTime;
            const wasCached = response.headers.get('X-Cache') === 'HIT' ||
                            response.status === 304;

            // Track metrics
            this.recordRequest({
                url,
                method: options.method || 'GET',
                status: response.status,
                duration,
                cached: wasCached,
                timestamp: new Date().toISOString(),
                size: response.headers.get('Content-Length')
            });

            if (wasCached) {
                this.metrics.cacheHits++;
            } else {
                this.metrics.cacheMisses++;
            }

            this.saveMetrics();
            return response;

        } catch (error) {
            performance.mark(endMark);
            const duration = performance.now() - startTime;

            this.recordRequest({
                url,
                method: options.method || 'GET',
                status: 'error',
                duration,
                error: error.message,
                timestamp: new Date().toISOString()
            });

            this.saveMetrics();
            throw error;
        }
    }

    recordRequest(data) {
        this.metrics.requests.push(data);
    }

    // Get performance statistics
    getStats() {
        const requests = this.metrics.requests;
        const durations = requests.map(r => r.duration).filter(d => d);

        const stats = {
            totalRequests: requests.length,
            cacheHitRate: this.metrics.cacheHits /
                (this.metrics.cacheHits + this.metrics.cacheMisses) * 100,
            averageResponseTime: durations.reduce((a, b) => a + b, 0) / durations.length,
            p95: this.percentile(durations, 95),
            p99: this.percentile(durations, 99),
            slowestRequests: requests
                .sort((a, b) => b.duration - a.duration)
                .slice(0, 5),
            errors: requests.filter(r => r.status === 'error').length
        };

        return stats;
    }

    percentile(arr, p) {
        const sorted = [...arr].sort((a, b) => a - b);
        const index = Math.ceil((p / 100) * sorted.length) - 1;
        return sorted[index];
    }

    // Clear metrics
    reset() {
        this.metrics = { requests: [], cacheHits: 0, cacheMisses: 0 };
        localStorage.removeItem(PERF_KEY);
    }
}

// Usage
const perfMonitor = new PerformanceMonitor();

// Use instead of regular fetch
async function getUsers() {
    const response = await perfMonitor.trackedFetch('/api/users');
    return response.json();
}

// View statistics
console.log('Performance Stats:', perfMonitor.getStats());
console.table(perfMonitor.metrics.requests.slice(-10));
</code></pre>
                    </div>
                </div>

                <div class="exercise">
                    <h4>üèãÔ∏è Exercise: Implement Complete Caching Strategy</h4>
                    <p><strong>Scenario:</strong> You have a products API that gets hit frequently. Implement a multi-layer caching strategy.</p>
                    <p><strong>Task:</strong> Create an API with Redis caching, HTTP cache headers, and cache invalidation.</p>
                    <p><strong>Requirements:</strong></p>
                    <ul>
                        <li>GET /api/products - Cache for 5 minutes in Redis</li>
                        <li>Add ETag support for conditional requests</li>
                        <li>POST/PUT/DELETE should invalidate the cache</li>
                        <li>Include Cache-Control headers</li>
                    </ul>

                    <details>
                        <summary>üí° Hint</summary>
                        <p>Combine Redis middleware for server-side caching with ETag generation for client-side caching. Use cache invalidation on mutations.</p>
                    </details>

                    <details>
                        <summary>‚úÖ Solution</summary>
                        <div class="code-block">
                            <div class="code-header">
                                <span>JavaScript - Multi-Layer Caching Solution</span>
                                <button class="copy-btn" onclick="copyCode(this, 'solution-d6')">Copy</button>
                            </div>
                            <pre><code id="solution-d6">const express = require('express');
const redis = require('redis');
const crypto = require('crypto');
const app = express();
app.use(express.json());

const redisClient = redis.createClient();
redisClient.connect();

let products = [
    { id: 1, name: 'Laptop', price: 999, lastModified: Date.now() }
];

// Combined caching middleware
const multiLayerCache = (duration) => {
    return async (req, res, next) => {
        const cacheKey = `cache:${req.originalUrl}`;

        // Layer 1: Redis cache
        try {
            const cached = await redisClient.get(cacheKey);
            if (cached) {
                const data = JSON.parse(cached);
                const etag = crypto.createHash('md5').update(cached).digest('hex');

                res.set('ETag', etag);
                res.set('X-Cache', 'HIT');
                res.set('Cache-Control', `public, max-age=${duration}`);

                // Layer 2: ETag validation
                if (req.headers['if-none-match'] === etag) {
                    return res.status(304).end();
                }

                return res.json(data);
            }
        } catch (error) {
            console.error('Redis error:', error);
        }

        // Cache miss - intercept response
        const originalJson = res.json.bind(res);
        res.json = (data) => {
            const content = JSON.stringify(data);
            const etag = crypto.createHash('md5').update(content).digest('hex');

            // Store in Redis
            redisClient.setEx(cacheKey, duration, content);

            // Set headers
            res.set('ETag', etag);
            res.set('X-Cache', 'MISS');
            res.set('Cache-Control', `public, max-age=${duration}`);

            originalJson(data);
        };

        next();
    };
};

// Invalidate cache helper
const invalidateCache = async (pattern = 'cache:*') => {
    const keys = await redisClient.keys(pattern);
    if (keys.length > 0) {
        await redisClient.del(keys);
    }
    console.log(`Invalidated ${keys.length} cache entries`);
};

// GET - with caching
app.get('/api/products', multiLayerCache(300), (req, res) => {
    res.json({
        products,
        timestamp: new Date().toISOString()
    });
});

// POST - invalidate cache
app.post('/api/products', async (req, res) => {
    const newProduct = {
        id: products.length + 1,
        ...req.body,
        lastModified: Date.now()
    };
    products.push(newProduct);

    await invalidateCache('cache:/api/products*');

    res.status(201).json(newProduct);
});

// PUT - invalidate cache
app.put('/api/products/:id', async (req, res) => {
    const id = parseInt(req.params.id);
    const index = products.findIndex(p => p.id === id);

    if (index === -1) {
        return res.status(404).json({ error: 'Not found' });
    }

    products[index] = { ...products[index], ...req.body, lastModified: Date.now() };
    await invalidateCache('cache:/api/products*');

    res.json(products[index]);
});

// DELETE - invalidate cache
app.delete('/api/products/:id', async (req, res) => {
    products = products.filter(p => p.id !== parseInt(req.params.id));
    await invalidateCache('cache:/api/products*');
    res.status(204).send();
});

app.listen(3000);
</code></pre>
                        </div>
                    </details>
                </div>

                <div class="quiz">
                    <h3>‚úÖ Check Your Knowledge</h3>

                    <div class="quiz-question">
                        <p><strong>Q1:</strong> What HTTP status code indicates "Not Modified" for conditional requests?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d6q1" value="a"> A) 200</label>
                            <label><input type="radio" name="d6q1" value="b"> B) 304</label>
                            <label><input type="radio" name="d6q1" value="c"> C) 404</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d6q1', 'b', 'd6q1-fb')">Check Answer</button>
                        <div class="feedback" id="d6q1-fb"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Q2:</strong> What's the purpose of rate limiting?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d6q2" value="a"> A) Make the API slower</label>
                            <label><input type="radio" name="d6q2" value="b"> B) Prevent abuse and ensure fair usage</label>
                            <label><input type="radio" name="d6q2" value="c"> C) Cache responses</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d6q2', 'b', 'd6q2-fb')">Check Answer</button>
                        <div class="feedback" id="d6q2-fb"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Q3:</strong> Which cache header value prevents caching entirely?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d6q3" value="a"> A) Cache-Control: public</label>
                            <label><input type="radio" name="d6q3" value="b"> B) Cache-Control: max-age=3600</label>
                            <label><input type="radio" name="d6q3" value="c"> C) Cache-Control: no-store</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d6q3', 'c', 'd6q3-fb')">Check Answer</button>
                        <div class="feedback" id="d6q3-fb"></div>
                    </div>
                </div>

                <div class="takeaways">
                    <h3>üéØ Key Takeaways</h3>
                    <ul>
                        <li>Multi-layer caching (Redis + HTTP headers) provides best performance</li>
                        <li>ETags enable efficient conditional requests (304 Not Modified)</li>
                        <li>Rate limiting protects your API from abuse and ensures fair usage</li>
                        <li>Always invalidate cache after data mutations (POST/PUT/DELETE)</li>
                        <li>Use appropriate Cache-Control directives for different content types</li>
                    </ul>
                    <p><strong>Tomorrow:</strong> API Documentation & Testing - OpenAPI/Swagger, automated testing, and deployment.</p>
                </div>

                <button class="complete-day" onclick="completeDay(6)">‚úì Mark Day 6 Complete</button>
            </div>

            <!-- DAY 7 CONTENT -->
            <div id="day7" class="day-content">
                <h2>üìò Day 7: API Documentation, Testing & Deployment</h2>

                <div class="objectives">
                    <h3>üéØ Learning Objectives</h3>
                    <ul>
                        <li>Create comprehensive API documentation with OpenAPI/Swagger</li>
                        <li>Write automated tests for API endpoints</li>
                        <li>Implement integration testing with Jest and Supertest</li>
                        <li>Deploy API to production (Heroku, Vercel, Railway)</li>
                        <li>Set up CI/CD with GitHub Actions</li>
                    </ul>
                </div>

                <h3>üìö Core Concepts</h3>

                <div class="concept-grid">
                    <div class="concept-card">
                        <h4>üìñ OpenAPI/Swagger</h4>
                        <p>Industry-standard specification for documenting REST APIs. Generate interactive docs and client SDKs automatically.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üß™ Automated Testing</h4>
                        <p>Write unit and integration tests with Jest/Supertest. Test endpoints, status codes, response formats automatically.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üöÄ CI/CD</h4>
                        <p>Continuous Integration/Deployment with GitHub Actions. Automatically test and deploy on every commit.</p>
                    </div>
                    <div class="concept-card">
                        <h4>üåê Production Deploy</h4>
                        <p>Deploy to cloud platforms (Heroku, Vercel, Railway). Configure environment variables and monitoring.</p>
                    </div>
                </div>

                <h3>üíª Code Examples</h3>

                <h4>1. OpenAPI/Swagger Documentation</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - Swagger Setup (npm install swagger-jsdoc swagger-ui-express)</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d7-1')">Copy</button>
                    </div>
                    <pre><code id="code-d7-1">const express = require('express');
const swaggerJsdoc = require('swagger-jsdoc');
const swaggerUi = require('swagger-ui-express');
const app = express();
app.use(express.json());

// Swagger configuration
const swaggerOptions = {
    definition: {
        openapi: '3.0.0',
        info: {
            title: 'RESTful API Learning Module',
            version: '1.0.0',
            description: 'A complete REST API with authentication, caching, and rate limiting',
            contact: {
                name: 'API Support',
                email: 'support@example.com'
            }
        },
        servers: [
            {
                url: 'http://localhost:3000',
                description: 'Development server'
            },
            {
                url: 'https://api.production.com',
                description: 'Production server'
            }
        ],
        components: {
            securitySchemes: {
                bearerAuth: {
                    type: 'http',
                    scheme: 'bearer',
                    bearerFormat: 'JWT'
                }
            },
            schemas: {
                User: {
                    type: 'object',
                    required: ['name', 'email'],
                    properties: {
                        id: {
                            type: 'integer',
                            description: 'User ID',
                            example: 1
                        },
                        name: {
                            type: 'string',
                            description: 'User name',
                            example: 'Alice Johnson'
                        },
                        email: {
                            type: 'string',
                            format: 'email',
                            description: 'User email',
                            example: 'alice@example.com'
                        }
                    }
                },
                Error: {
                    type: 'object',
                    properties: {
                        error: {
                            type: 'string',
                            example: 'Not found'
                        },
                        message: {
                            type: 'string',
                            example: 'Resource not found'
                        }
                    }
                }
            }
        }
    },
    apis: ['./routes/*.js', './server.js'] // Path to API docs
};

const swaggerSpec = swaggerJsdoc(swaggerOptions);

// Serve swagger docs
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerSpec));

// Sample data
let users = [
    { id: 1, name: 'Alice', email: 'alice@example.com' }
];

/**
 * @swagger
 * /api/users:
 *   get:
 *     summary: Get all users
 *     description: Retrieve a list of all users
 *     tags: [Users]
 *     responses:
 *       200:
 *         description: A list of users
 *         content:
 *           application/json:
 *             schema:
 *               type: array
 *               items:
 *                 $ref: '#/components/schemas/User'
 */
app.get('/api/users', (req, res) => {
    res.json(users);
});

/**
 * @swagger
 * /api/users/{id}:
 *   get:
 *     summary: Get user by ID
 *     description: Retrieve a single user by their ID
 *     tags: [Users]
 *     parameters:
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: integer
 *         description: User ID
 *     responses:
 *       200:
 *         description: User found
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/User'
 *       404:
 *         description: User not found
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/Error'
 */
app.get('/api/users/:id', (req, res) => {
    const user = users.find(u => u.id === parseInt(req.params.id));
    if (!user) return res.status(404).json({ error: 'User not found' });
    res.json(user);
});

/**
 * @swagger
 * /api/users:
 *   post:
 *     summary: Create new user
 *     description: Create a new user with name and email
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             required:
 *               - name
 *               - email
 *             properties:
 *               name:
 *                 type: string
 *                 example: Bob Smith
 *               email:
 *                 type: string
 *                 format: email
 *                 example: bob@example.com
 *     responses:
 *       201:
 *         description: User created successfully
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/User'
 *       400:
 *         description: Invalid input
 */
app.post('/api/users', (req, res) => {
    const { name, email } = req.body;
    if (!name || !email) {
        return res.status(400).json({ error: 'Name and email required' });
    }
    const newUser = { id: users.length + 1, name, email };
    users.push(newUser);
    res.status(201).json(newUser);
});

app.listen(3000, () => {
    console.log('API running on port 3000');
    console.log('Swagger docs available at http://localhost:3000/api-docs');
});
</code></pre>
                </div>

                <h4>2. Automated Testing with Jest & Supertest</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JavaScript - API Tests (npm install --save-dev jest supertest)</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d7-2')">Copy</button>
                    </div>
                    <pre><code id="code-d7-2">// api.test.js
const request = require('supertest');
const express = require('express');

// Create test app
const createApp = () => {
    const app = express();
    app.use(express.json());

    let users = [
        { id: 1, name: 'Alice', email: 'alice@example.com' },
        { id: 2, name: 'Bob', email: 'bob@example.com' }
    ];

    app.get('/api/users', (req, res) => {
        res.json(users);
    });

    app.get('/api/users/:id', (req, res) => {
        const user = users.find(u => u.id === parseInt(req.params.id));
        if (!user) return res.status(404).json({ error: 'User not found' });
        res.json(user);
    });

    app.post('/api/users', (req, res) => {
        const { name, email } = req.body;
        if (!name || !email) {
            return res.status(400).json({ error: 'Name and email required' });
        }
        const newUser = { id: users.length + 1, name, email };
        users.push(newUser);
        res.status(201).json(newUser);
    });

    app.delete('/api/users/:id', (req, res) => {
        const index = users.findIndex(u => u.id === parseInt(req.params.id));
        if (index === -1) {
            return res.status(404).json({ error: 'User not found' });
        }
        users.splice(index, 1);
        res.status(204).send();
    });

    return app;
};

describe('Users API', () => {
    let app;

    beforeEach(() => {
        app = createApp();
    });

    describe('GET /api/users', () => {
        it('should return all users', async () => {
            const response = await request(app)
                .get('/api/users')
                .expect('Content-Type', /json/)
                .expect(200);

            expect(response.body).toBeInstanceOf(Array);
            expect(response.body.length).toBeGreaterThan(0);
            expect(response.body[0]).toHaveProperty('id');
            expect(response.body[0]).toHaveProperty('name');
            expect(response.body[0]).toHaveProperty('email');
        });
    });

    describe('GET /api/users/:id', () => {
        it('should return a user by ID', async () => {
            const response = await request(app)
                .get('/api/users/1')
                .expect(200);

            expect(response.body).toHaveProperty('id', 1);
            expect(response.body).toHaveProperty('name');
            expect(response.body).toHaveProperty('email');
        });

        it('should return 404 for non-existent user', async () => {
            const response = await request(app)
                .get('/api/users/999')
                .expect(404);

            expect(response.body).toHaveProperty('error');
        });
    });

    describe('POST /api/users', () => {
        it('should create a new user', async () => {
            const newUser = {
                name: 'Charlie',
                email: 'charlie@example.com'
            };

            const response = await request(app)
                .post('/api/users')
                .send(newUser)
                .expect('Content-Type', /json/)
                .expect(201);

            expect(response.body).toHaveProperty('id');
            expect(response.body.name).toBe(newUser.name);
            expect(response.body.email).toBe(newUser.email);
        });

        it('should return 400 if name is missing', async () => {
            const response = await request(app)
                .post('/api/users')
                .send({ email: 'test@example.com' })
                .expect(400);

            expect(response.body).toHaveProperty('error');
        });

        it('should return 400 if email is missing', async () => {
            const response = await request(app)
                .post('/api/users')
                .send({ name: 'Test User' })
                .expect(400);

            expect(response.body).toHaveProperty('error');
        });
    });

    describe('DELETE /api/users/:id', () => {
        it('should delete a user', async () => {
            await request(app)
                .delete('/api/users/1')
                .expect(204);

            // Verify user is deleted
            await request(app)
                .get('/api/users/1')
                .expect(404);
        });

        it('should return 404 for non-existent user', async () => {
            await request(app)
                .delete('/api/users/999')
                .expect(404);
        });
    });
});

// Run tests with: npm test
</code></pre>
                </div>

                <h4>3. GitHub Actions CI/CD Pipeline</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>YAML - GitHub Actions Workflow (.github/workflows/ci.yml)</span>
                        <button class="copy-btn" onclick="copyCode(this, 'code-d7-3')">Copy</button>
                    </div>
                    <pre><code id="code-d7-3">name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x, 18.x, 20.x]

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Run linter
      run: npm run lint

    - name: Run tests
      run: npm test

    - name: Run tests with coverage
      run: npm run test:coverage

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage/lcov.info

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Deploy to Heroku
      uses: akhileshns/heroku-deploy@v3.12.14
      with:
        heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
        heroku_app_name: "your-app-name"
        heroku_email: "your-email@example.com"

    - name: Deploy to Vercel
      uses: amondnet/vercel-action@v20
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
        vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
        vercel-args: '--prod'

    - name: Notify deployment
      run: |
        echo "Deployment successful!"
        echo "API URL: https://your-app-name.herokuapp.com"
</code></pre>
                </div>

                <div class="storage-demo">
                    <h4>üíæ localStorage Practical: Test Results Tracker</h4>
                    <p>Track your testing progress and test coverage over time:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>JavaScript - Test Results Tracker</span>
                            <button class="copy-btn" onclick="copyCode(this, 'storage-d7')">Copy</button>
                        </div>
                        <pre><code id="storage-d7">// Test Results Tracker - Monitor testing progress
const TEST_RESULTS_KEY = 'day7_test_results';
const MAX_HISTORY = 50;

class TestResultsTracker {
    constructor() {
        this.results = this.loadResults();
    }

    loadResults() {
        const data = localStorage.getItem(TEST_RESULTS_KEY);
        return data ? JSON.parse(data) : [];
    }

    saveResults() {
        if (this.results.length > MAX_HISTORY) {
            this.results = this.results.slice(-MAX_HISTORY);
        }
        localStorage.setItem(TEST_RESULTS_KEY, JSON.stringify(this.results));
    }

    // Record test run results
    recordTestRun(data) {
        const result = {
            id: Date.now(),
            timestamp: new Date().toISOString(),
            totalTests: data.totalTests || 0,
            passed: data.passed || 0,
            failed: data.failed || 0,
            skipped: data.skipped || 0,
            duration: data.duration || 0,
            coverage: {
                lines: data.coverage?.lines || 0,
                branches: data.coverage?.branches || 0,
                functions: data.coverage?.functions || 0,
                statements: data.coverage?.statements || 0
            },
            failedTests: data.failedTests || []
        };

        this.results.push(result);
        this.saveResults();

        console.log(`‚úÖ Test run recorded: ${result.passed}/${result.totalTests} passed`);
        return result;
    }

    // Get statistics
    getStats() {
        if (this.results.length === 0) {
            return { noData: true };
        }

        const latestRun = this.results[this.results.length - 1];
        const totalRuns = this.results.length;

        const averageCoverage = {
            lines: this.average('coverage.lines'),
            branches: this.average('coverage.branches'),
            functions: this.average('coverage.functions'),
            statements: this.average('coverage.statements')
        };

        const passRate = this.results.map(r =>
            (r.passed / r.totalTests) * 100
        );

        return {
            totalRuns,
            latestRun,
            averagePassRate: this.arrayAverage(passRate),
            averageCoverage,
            trend: this.calculateTrend(),
            mostFailedTests: this.getMostFailedTests()
        };
    }

    average(path) {
        const values = this.results.map(r => {
            const parts = path.split('.');
            let value = r;
            for (const part of parts) {
                value = value[part];
            }
            return value;
        });
        return this.arrayAverage(values);
    }

    arrayAverage(arr) {
        return arr.reduce((a, b) => a + b, 0) / arr.length;
    }

    calculateTrend() {
        if (this.results.length < 5) return 'Not enough data';

        const recent5 = this.results.slice(-5);
        const passRates = recent5.map(r => (r.passed / r.totalTests) * 100);

        const trend = passRates[passRates.length - 1] - passRates[0];
        if (trend > 5) return 'üìà Improving';
        if (trend < -5) return 'üìâ Declining';
        return '‚û°Ô∏è Stable';
    }

    getMostFailedTests() {
        const failureCount = {};

        this.results.forEach(run => {
            run.failedTests.forEach(testName => {
                failureCount[testName] = (failureCount[testName] || 0) + 1;
            });
        });

        return Object.entries(failureCount)
            .sort(([, a], [, b]) => b - a)
            .slice(0, 5)
            .map(([name, count]) => ({ name, count }));
    }

    // Clear history
    reset() {
        this.results = [];
        localStorage.removeItem(TEST_RESULTS_KEY);
        console.log('üóëÔ∏è Test results cleared');
    }

    // Generate test report
    generateReport() {
        const stats = this.getStats();

        console.log('üìä Test Results Summary');
        console.log('======================');
        console.log(`Total Runs: ${stats.totalRuns}`);
        console.log(`Average Pass Rate: ${stats.averagePassRate.toFixed(2)}%`);
        console.log(`Trend: ${stats.trend}`);
        console.log('\\nLatest Coverage:');
        console.log(`  Lines: ${stats.latestRun.coverage.lines}%`);
        console.log(`  Branches: ${stats.latestRun.coverage.branches}%`);
        console.log(`  Functions: ${stats.latestRun.coverage.functions}%`);

        if (stats.mostFailedTests.length > 0) {
            console.log('\\nMost Failed Tests:');
            console.table(stats.mostFailedTests);
        }

        return stats;
    }
}

// Usage
const testTracker = new TestResultsTracker();

// Record a test run
testTracker.recordTestRun({
    totalTests: 25,
    passed: 23,
    failed: 2,
    skipped: 0,
    duration: 3500,
    coverage: {
        lines: 87.5,
        branches: 82.3,
        functions: 90.1,
        statements: 85.7
    },
    failedTests: ['POST /api/users - should validate email', 'DELETE /api/users/:id - should return 404']
});

// View report
testTracker.generateReport();
</code></pre>
                    </div>
                </div>

                <div class="exercise">
                    <h4>üèãÔ∏è Final Project: Complete RESTful API</h4>
                    <p><strong>Scenario:</strong> Build a complete, production-ready Task Management API.</p>
                    <p><strong>Requirements:</strong></p>
                    <ul>
                        <li>Full CRUD operations for tasks (create, read, update, delete)</li>
                        <li>JWT authentication and authorization</li>
                        <li>Input validation and error handling</li>
                        <li>Rate limiting (100 requests per 15 minutes)</li>
                        <li>Caching with Redis for GET requests</li>
                        <li>Complete OpenAPI/Swagger documentation</li>
                        <li>Automated tests with 80%+ coverage</li>
                        <li>Deploy to Heroku or Vercel</li>
                    </ul>

                    <details>
                        <summary>üí° Planning Tips</summary>
                        <p>Break the project into phases: 1) Basic CRUD, 2) Authentication, 3) Performance features, 4) Documentation, 5) Testing, 6) Deployment. Use all concepts learned over 7 days.</p>
                    </details>

                    <details>
                        <summary>‚úÖ Solution Outline</summary>
                        <div class="code-block">
                            <div class="code-header">
                                <span>Project Structure</span>
                                <button class="copy-btn" onclick="copyCode(this, 'solution-d7')">Copy</button>
                            </div>
                            <pre><code id="solution-d7">task-management-api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js          # Authentication routes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.js         # Task CRUD routes
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js          # JWT verification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rateLimit.js     # Rate limiting
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache.js         # Redis caching
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ errorHandler.js  # Error handling
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ task.js          # Task data model
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.js    # Input validation
‚îÇ   ‚îî‚îÄ‚îÄ server.js            # Main app file
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ auth.test.js
‚îÇ   ‚îî‚îÄ‚îÄ tasks.test.js
‚îú‚îÄ‚îÄ .github/workflows/
‚îÇ   ‚îî‚îÄ‚îÄ ci.yml               # CI/CD pipeline
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md

// Key Features Implementation:

// 1. Task Model
const taskSchema = {
    id: Number,
    title: String,
    description: String,
    status: ['pending', 'in-progress', 'completed'],
    priority: ['low', 'medium', 'high'],
    userId: Number,
    dueDate: Date,
    createdAt: Date,
    updatedAt: Date
};

// 2. API Endpoints
/*
  POST   /api/auth/register    - Register new user
  POST   /api/auth/login       - Login user
  GET    /api/tasks            - Get all user's tasks (cached)
  GET    /api/tasks/:id        - Get task by ID
  POST   /api/tasks            - Create new task
  PUT    /api/tasks/:id        - Update task
  PATCH  /api/tasks/:id/status - Update task status only
  DELETE /api/tasks/:id        - Delete task
*/

// 3. Environment Variables (.env)
/*
  PORT=3000
  NODE_ENV=production
  JWT_SECRET=your-secret-key
  REDIS_URL=redis://localhost:6379
  DATABASE_URL=postgresql://...
*/

// 4. Testing Strategy
/*
  - Unit tests for validation functions
  - Integration tests for all API endpoints
  - Authentication flow tests
  - Rate limiting tests
  - Cache invalidation tests
  - Error handling tests
*/

// 5. Deployment Checklist
/*
  ‚úì Environment variables configured
  ‚úì Database migrations run
  ‚úì Redis instance connected
  ‚úì Health check endpoint (/health)
  ‚úì CORS configured
  ‚úì HTTPS enforced
  ‚úì Rate limiting enabled
  ‚úì Logging configured
  ‚úì Error monitoring (Sentry)
  ‚úì API documentation published
*/

// Start with: npm install express jsonwebtoken bcryptjs redis
//              express-rate-limit joi swagger-jsdoc swagger-ui-express
// Test with:   npm install --save-dev jest supertest
// Deploy:      git push heroku main OR vercel --prod
</code></pre>
                        </div>
                        <p><strong>Next Steps:</strong> Implement each feature incrementally, write tests as you go, and deploy early to catch issues.</p>
                    </details>
                </div>

                <div class="quiz">
                    <h3>‚úÖ Check Your Knowledge</h3>

                    <div class="quiz-question">
                        <p><strong>Q1:</strong> What is the standard specification for documenting REST APIs?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d7q1" value="a"> A) GraphQL Schema</label>
                            <label><input type="radio" name="d7q1" value="b"> B) OpenAPI (Swagger)</label>
                            <label><input type="radio" name="d7q1" value="c"> C) Markdown</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d7q1', 'b', 'd7q1-fb')">Check Answer</button>
                        <div class="feedback" id="d7q1-fb"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Q2:</strong> Which tool is commonly used for API integration testing in Node.js?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d7q2" value="a"> A) Postman only</label>
                            <label><input type="radio" name="d7q2" value="b"> B) Jest with Supertest</label>
                            <label><input type="radio" name="d7q2" value="c"> C) Selenium</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d7q2', 'b', 'd7q2-fb')">Check Answer</button>
                        <div class="feedback" id="d7q2-fb"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Q3:</strong> What does CI/CD stand for?</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="d7q3" value="a"> A) Code Integration / Code Delivery</label>
                            <label><input type="radio" name="d7q3" value="b"> B) Continuous Integration / Continuous Deployment</label>
                            <label><input type="radio" name="d7q3" value="c"> C) Central Intelligence / Central Development</label>
                        </div>
                        <button class="check-answer" onclick="checkAnswer('d7q3', 'b', 'd7q3-fb')">Check Answer</button>
                        <div class="feedback" id="d7q3-fb"></div>
                    </div>
                </div>

                <div class="takeaways">
                    <h3>üéØ Final Course Takeaways</h3>
                    <ul>
                        <li><strong>Day 1-2:</strong> REST fundamentals, HTTP methods, resource design, URL patterns</li>
                        <li><strong>Day 3-4:</strong> Error handling, status codes, authentication, authorization with JWT</li>
                        <li><strong>Day 5-6:</strong> API versioning, performance optimization, caching, rate limiting</li>
                        <li><strong>Day 7:</strong> Documentation with Swagger, automated testing, CI/CD, deployment</li>
                    </ul>
                    <p><strong>üéâ Congratulations!</strong> You've completed the 7-day RESTful API Design course. You now have the skills to build production-ready REST APIs with Express.js!</p>
                    <p><strong>Next Steps:</strong></p>
                    <ul>
                        <li>Complete the final project (Task Management API)</li>
                        <li>Deploy your API to a cloud platform</li>
                        <li>Explore advanced topics: GraphQL, WebSockets, Microservices</li>
                        <li>Build your portfolio with real-world API projects</li>
                    </ul>
                </div>

                <button class="complete-day" onclick="completeDay(7)">‚úì Mark Day 7 Complete üéâ</button>
            </div>
        </main>
    </div>

    <script>
        // Days configuration
        const days = [
            { id: 1, title: 'Day 1: REST Fundamentals', completed: false },
            { id: 2, title: 'Day 2: Resource Design', completed: false },
            { id: 3, title: 'Day 3: Error Handling', completed: false },
            { id: 4, title: 'Day 4: Authentication', completed: false },
            { id: 5, title: 'Day 5: API Versioning', completed: false },
            { id: 6, title: 'Day 6: Performance', completed: false },
            { id: 7, title: 'Day 7: Documentation', completed: false }
        ];

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('restapi_progress');
            if (saved) {
                const progress = JSON.parse(saved);
                days.forEach((day, index) => {
                    days[index].completed = progress[day.id] || false;
                });
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            const progress = {};
            days.forEach(day => {
                progress[day.id] = day.completed;
            });
            localStorage.setItem('restapi_progress', JSON.stringify(progress));
        }

        // Generate navigation
        function renderNav() {
            const navContainer = document.getElementById('nav-container');
            navContainer.innerHTML = days.map(day => `
                <div class="nav-item ${day.completed ? 'completed' : ''}"
                     data-day="${day.id}"
                     onclick="showDay(${day.id})">
                    <span>${day.title}</span>
                </div>
            `).join('');
            updateActiveNav();
        }

        // Update active navigation item
        function updateActiveNav() {
            const currentDay = getCurrentDay();
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.day) === currentDay) {
                    item.classList.add('active');
                }
            });
        }

        // Get current visible day
        function getCurrentDay() {
            const activeContent = document.querySelector('.day-content.active');
            return activeContent ? parseInt(activeContent.id.replace('day', '')) : 1;
        }

        // Show specific day content
        function showDay(dayNum) {
            document.querySelectorAll('.day-content').forEach(content => {
                content.classList.remove('active');
            });
            const dayContent = document.getElementById(`day${dayNum}`);
            if (dayContent) {
                dayContent.classList.add('active');
                updateActiveNav();
                updateProgress();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Complete a day
        function completeDay(dayNum) {
            days[dayNum - 1].completed = true;
            saveProgress();
            renderNav();
            updateProgress();

            // Move to next day if available
            if (dayNum < days.length) {
                setTimeout(() => showDay(dayNum + 1), 500);
            }
        }

        // Update progress bar
        function updateProgress() {
            const completed = days.filter(d => d.completed).length;
            const percentage = Math.round((completed / days.length) * 100);

            document.getElementById('progress-text').textContent = `${percentage}% Complete`;
            document.getElementById('days-completed').textContent = `${completed}/${days.length} Days`;

            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = `${percentage}%`;
            progressFill.textContent = percentage > 0 ? `${percentage}%` : '';
        }

        // Copy code to clipboard (enhanced version below in ENHANCED CODE BLOCK FUNCTIONS section)

        // Check quiz answer
        function checkAnswer(questionName, correctAnswer, feedbackId) {
            const selected = document.querySelector(`input[name="${questionName}"]:checked`);
            const feedback = document.getElementById(feedbackId);

            if (!selected) {
                feedback.className = 'feedback incorrect';
                feedback.textContent = 'Please select an answer.';
                feedback.style.display = 'block';
                return;
            }

            if (selected.value === correctAnswer) {
                feedback.className = 'feedback correct';
                feedback.textContent = '‚úì Correct! Great job!';
            } else {
                feedback.className = 'feedback incorrect';
                feedback.textContent = '‚úó Incorrect. Try again or review the material.';
            }
            feedback.style.display = 'block';
        }

        // Toggle dark mode
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('restapi_theme', isDark ? 'dark' : 'light');
            document.querySelector('.theme-toggle').textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress?')) {
                localStorage.removeItem('restapi_progress');
                days.forEach(day => day.completed = false);
                renderNav();
                updateProgress();
                showDay(1);
            }
        }

        // Load theme preference
        function loadTheme() {
            const theme = localStorage.getItem('restapi_theme');
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è Light Mode';
            }
        }

        // ============================================================
        // ENHANCED CODE BLOCK FUNCTIONS
        // ============================================================

        /**
         * Toggle between simple and full code variants
         * @param {HTMLElement} button - The toggle button element
         */
        function toggleCodeVariant(button) {
            try {
                // Find the parent code block container
                const codeBlock = button.closest('.code-block');
                if (!codeBlock) {
                    console.error('Code block container not found');
                    return;
                }

                // Find variant containers
                const simpleVariant = codeBlock.querySelector('.code-variant-simple');
                const fullVariant = codeBlock.querySelector('.code-variant-full');

                if (!simpleVariant || !fullVariant) {
                    console.error('Code variants not found');
                    return;
                }

                // Check current state
                const isShowingSimple = simpleVariant.style.display !== 'none';

                // Toggle visibility
                if (isShowingSimple) {
                    simpleVariant.style.display = 'none';
                    fullVariant.style.display = 'block';
                    button.textContent = 'Show Simple';
                    button.setAttribute('aria-label', 'Switch to simple code version');
                } else {
                    simpleVariant.style.display = 'block';
                    fullVariant.style.display = 'none';
                    button.textContent = 'Show Full';
                    button.setAttribute('aria-label', 'Switch to full code version');
                }

                // Re-trigger syntax highlighting if Prism is available
                if (typeof Prism !== 'undefined') {
                    const visibleVariant = isShowingSimple ? fullVariant : simpleVariant;
                    const codeElement = visibleVariant.querySelector('code');
                    if (codeElement) {
                        Prism.highlightElement(codeElement);
                    }
                }
            } catch (error) {
                console.error('Error toggling code variant:', error);
            }
        }

        /**
         * Switch between tabbed code examples
         * @param {HTMLElement} button - The tab button element
         * @param {string} tabName - The name/ID of the tab to show
         */
        function switchTab(button, tabName) {
            try {
                // Find the parent code block container
                const codeBlock = button.closest('.code-block');
                if (!codeBlock) {
                    console.error('Code block container not found');
                    return;
                }

                // Get all tab buttons and content panels in this code block
                const tabButtons = codeBlock.querySelectorAll('.tab-button');
                const tabContents = codeBlock.querySelectorAll('.tab-content');

                if (tabButtons.length === 0 || tabContents.length === 0) {
                    console.error('Tab buttons or content not found');
                    return;
                }

                // Remove active class from all buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                });

                // Hide all tab contents
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    content.style.display = 'none';
                });

                // Activate clicked button
                button.classList.add('active');
                button.setAttribute('aria-selected', 'true');

                // Show corresponding tab content
                const targetContent = codeBlock.querySelector(`[data-tab="${tabName}"]`);
                if (targetContent) {
                    targetContent.classList.add('active');
                    targetContent.style.display = 'block';

                    // Re-trigger syntax highlighting if Prism is available
                    if (typeof Prism !== 'undefined') {
                        const codeElement = targetContent.querySelector('code');
                        if (codeElement) {
                            Prism.highlightElement(codeElement);
                        }
                    }
                } else {
                    console.warn(`Tab content with data-tab="${tabName}" not found`);
                }
            } catch (error) {
                console.error('Error switching tabs:', error);
            }
        }

        /**
         * Enhanced copy code function with support for variants and tabs
         * @param {HTMLElement} button - The copy button element
         * @param {string} codeId - The ID of the code element (optional for variant/tab support)
         */
        function copyCode(button, codeId) {
            try {
                let codeText = '';

                // If codeId is provided, use the traditional approach
                if (codeId) {
                    const codeBlock = document.getElementById(codeId);
                    if (codeBlock) {
                        codeText = codeBlock.textContent;
                    } else {
                        console.error(`Code block with id "${codeId}" not found`);
                        return;
                    }
                } else {
                    // Handle variants and tabs - find the currently visible code
                    const codeBlockContainer = button.closest('.code-block');
                    if (!codeBlockContainer) {
                        console.error('Code block container not found');
                        return;
                    }

                    // Try to find visible code variant
                    const visibleVariant = Array.from(
                        codeBlockContainer.querySelectorAll('.code-variant-simple, .code-variant-full')
                    ).find(variant => variant.style.display !== 'none');

                    if (visibleVariant) {
                        const codeElement = visibleVariant.querySelector('code') || visibleVariant.querySelector('pre');
                        codeText = codeElement ? codeElement.textContent : '';
                    } else {
                        // Try to find active tab content
                        const activeTab = codeBlockContainer.querySelector('.tab-content.active');
                        if (activeTab) {
                            const codeElement = activeTab.querySelector('code') || activeTab.querySelector('pre');
                            codeText = codeElement ? codeElement.textContent : '';
                        } else {
                            // Fallback: find any code element
                            const codeElement = codeBlockContainer.querySelector('code') || codeBlockContainer.querySelector('pre');
                            codeText = codeElement ? codeElement.textContent : '';
                        }
                    }
                }

                // Copy to clipboard
                if (codeText) {
                    navigator.clipboard.writeText(codeText).then(() => {
                        // Store original text
                        const originalText = button.textContent;

                        // Update button state
                        button.textContent = '‚úì Copied!';
                        button.classList.add('copied');
                        button.disabled = true;

                        // Reset after 2 seconds
                        setTimeout(() => {
                            button.textContent = originalText || 'Copy';
                            button.classList.remove('copied');
                            button.disabled = false;
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy code:', err);
                        button.textContent = '‚úó Failed';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                } else {
                    console.error('No code text found to copy');
                }
            } catch (error) {
                console.error('Error copying code:', error);
            }
        }

        /**
         * Initialize Prism.js syntax highlighting with line numbers
         * Call this after DOM is ready or after dynamically adding code blocks
         */
        function initializePrism() {
            try {
                // Check if Prism is loaded
                if (typeof Prism === 'undefined') {
                    console.warn('Prism.js is not loaded. Syntax highlighting will not be available.');
                    return;
                }

                // Configure Prism plugins if available
                if (Prism.plugins && Prism.plugins.lineNumbers) {
                    // Line numbers plugin is available
                    console.log('Prism line numbers plugin detected');
                }

                // Highlight all code blocks
                Prism.highlightAll();

                // Add language labels to code blocks if not present
                document.querySelectorAll('pre[class*="language-"]').forEach(pre => {
                    const langClass = Array.from(pre.classList).find(cls => cls.startsWith('language-'));
                    if (langClass && !pre.hasAttribute('data-language')) {
                        const language = langClass.replace('language-', '');
                        pre.setAttribute('data-language', language);
                    }
                });

                console.log('Prism.js initialized successfully');
            } catch (error) {
                console.error('Error initializing Prism:', error);
            }
        }

        /**
         * Helper function: Re-highlight a specific code element
         * Useful after dynamic content updates
         * @param {HTMLElement} element - The code element to highlight
         */
        function rehighlightCode(element) {
            try {
                if (typeof Prism !== 'undefined' && element) {
                    Prism.highlightElement(element);
                }
            } catch (error) {
                console.error('Error re-highlighting code:', error);
            }
        }

        /**
         * Helper function: Get code content from any code block structure
         * Handles variants, tabs, and standard code blocks
         * @param {HTMLElement} container - The code block container
         * @returns {string} The code text content
         */
        function getCodeContent(container) {
            try {
                if (!container) return '';

                // Try visible variant
                const visibleVariant = Array.from(
                    container.querySelectorAll('.code-variant-simple, .code-variant-full')
                ).find(variant => variant.style.display !== 'none');

                if (visibleVariant) {
                    const codeElement = visibleVariant.querySelector('code') || visibleVariant.querySelector('pre');
                    return codeElement ? codeElement.textContent : '';
                }

                // Try active tab
                const activeTab = container.querySelector('.tab-content.active');
                if (activeTab) {
                    const codeElement = activeTab.querySelector('code') || activeTab.querySelector('pre');
                    return codeElement ? codeElement.textContent : '';
                }

                // Fallback to any code element
                const codeElement = container.querySelector('code') || container.querySelector('pre');
                return codeElement ? codeElement.textContent : '';
            } catch (error) {
                console.error('Error getting code content:', error);
                return '';
            }
        }

        /**
         * Helper function: Initialize all enhanced code blocks
         * Call this if code blocks are added dynamically
         */
        function initializeCodeBlocks() {
            try {
                // Initialize any tabbed code blocks (set first tab as active)
                document.querySelectorAll('.code-block').forEach(block => {
                    const tabButtons = block.querySelectorAll('.tab-button');
                    const tabContents = block.querySelectorAll('.tab-content');

                    if (tabButtons.length > 0 && tabContents.length > 0) {
                        // Check if any tab is already active
                        const hasActiveTab = Array.from(tabButtons).some(btn => btn.classList.contains('active'));

                        if (!hasActiveTab) {
                            // Activate first tab
                            tabButtons[0].classList.add('active');
                            tabButtons[0].setAttribute('aria-selected', 'true');

                            if (tabContents[0]) {
                                tabContents[0].classList.add('active');
                                tabContents[0].style.display = 'block';
                            }

                            // Hide other tabs
                            for (let i = 1; i < tabContents.length; i++) {
                                tabContents[i].style.display = 'none';
                            }
                        }
                    }

                    // Initialize variant toggles (show simple by default)
                    const simpleVariant = block.querySelector('.code-variant-simple');
                    const fullVariant = block.querySelector('.code-variant-full');

                    if (simpleVariant && fullVariant) {
                        // Check current state, if not set, show simple by default
                        if (!simpleVariant.style.display && !fullVariant.style.display) {
                            simpleVariant.style.display = 'block';
                            fullVariant.style.display = 'none';
                        }
                    }
                });

                // Initialize Prism if available
                if (typeof Prism !== 'undefined') {
                    initializePrism();
                }

                console.log('Code blocks initialized');
            } catch (error) {
                console.error('Error initializing code blocks:', error);
            }
        }

        // ============================================================
        // END ENHANCED CODE BLOCK FUNCTIONS
        // ============================================================

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadProgress();
            renderNav();
            updateProgress();
            initializeCodeBlocks(); // Initialize enhanced code blocks
        });
    </script>
</body>
</html>
